<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="robots" content="noindex, nofollow">
<title>Min V√§lm√•ende-app</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Onest:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f0f4f8; --card: #ffffff; --text: #1e3a3a; --text2: #607070;
  --accent: #2d5a27; --accent2: #3a7a32; --nav-bg: #ffffff;
  --input-bg: #f4f7f9; --border: rgba(0,0,0,0.07);
  --shadow: 0 4px 24px rgba(0,0,0,0.07);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
  --radius: 20px; --nav-w: 220px;
}
body.dark {
  --bg: #0f1419; --card: #1a2230; --text: #e8f0f0; --text2: #8aa0a0;
  --accent: #4caf50; --accent2: #66bb6a; --nav-bg: #141c28;
  --input-bg: #1e2a3a; --border: rgba(255,255,255,0.07);
  --shadow: 0 4px 24px rgba(0,0,0,0.3); --shadow-lg: 0 8px 40px rgba(0,0,0,0.4);
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body { font-family: 'Onest', -apple-system, sans-serif; background: var(--bg); color: var(--text); overflow: hidden; transition: background .4s, color .4s; }

/* PIN SETUP */
#pin-setup{position:fixed;inset:0;background:linear-gradient(160deg,#1a2a3a,#0d1420);display:flex;align-items:center;justify-content:center;z-index:10000;}
#pin-setup.hidden{display:none;}
.setup-box{display:flex;flex-direction:column;align-items:center;gap:16px;padding:20px;}
.setup-title{color:#fff;font-size:1.5rem;font-weight:700;}
.setup-sub{color:rgba(255,255,255,.6);font-size:.9rem;text-align:center;line-height:1.5;max-width:280px;}


#lock {
  position:fixed;inset:0;background:linear-gradient(160deg,#1a3a2a,#0d1f14);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:18px;z-index:9999;
}
#lock.hidden{display:none;}
.lock-icon{font-size:3rem;animation:lockPulse 2s infinite ease-in-out;}
@keyframes lockPulse{0%,100%{transform:scale(1);opacity:.9;}50%{transform:scale(1.08);opacity:1;}}
.lock-title{color:#fff;font-size:1.5rem;font-weight:700;letter-spacing:-.5px;}
.lock-sub{color:rgba(255,255,255,.5);font-size:.9rem;margin-top:-10px;}
.pin-dots{display:flex;gap:14px;margin:4px 0;}
.pin-dot{width:14px;height:14px;border-radius:50%;border:2px solid rgba(255,255,255,.35);background:transparent;transition:.15s;}
.pin-dot.filled{background:#4caf50;border-color:#4caf50;transform:scale(1.2);}
.pin-dot.error{background:#ef5350;border-color:#ef5350;animation:shake .4s ease;}
@keyframes shake{0%,100%{transform:translateX(0);}20%{transform:translateX(-6px);}40%{transform:translateX(6px);}60%{transform:translateX(-4px);}80%{transform:translateX(4px);}}
.lock-err{color:#ef5350;font-size:.85rem;min-height:18px;text-align:center;}
.numpad{display:grid;grid-template-columns:repeat(3,70px);gap:12px;}
.nbtn{width:70px;height:70px;border-radius:50%;border:none;background:rgba(255,255,255,.1);color:#fff;font-size:1.5rem;font-weight:500;cursor:pointer;backdrop-filter:blur(4px);transition:.15s;display:flex;align-items:center;justify-content:center;}
.nbtn:active{background:rgba(255,255,255,.25);transform:scale(.93);}
.nbtn.empty{background:transparent;pointer-events:none;}
.faceid-btn{background:none;border:1.5px solid rgba(255,255,255,.3);color:rgba(255,255,255,.7);padding:9px 22px;border-radius:20px;font-size:.9rem;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:8px;}
.faceid-btn.hidden{display:none;}

/* ‚ïê‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê */
#shell{display:flex;position:fixed;inset:0;}

/* Sidebar (iPad/desktop) */
#sidebar{
  width:var(--nav-w);flex-shrink:0;background:var(--nav-bg);
  box-shadow:2px 0 20px rgba(0,0,0,.08);
  display:flex;flex-direction:column;padding:24px 16px 20px;
  gap:6px;z-index:10;
}
.side-logo{font-size:1.1rem;font-weight:700;color:var(--accent);padding:0 8px 20px;border-bottom:1px solid var(--border);margin-bottom:6px;}
.side-btn{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:14px;border:none;background:none;color:var(--text2);font-family:inherit;font-size:.95rem;font-weight:500;cursor:pointer;text-align:left;transition:.2s;width:100%;}
.side-btn .ico{font-size:1.3rem;width:28px;text-align:center;}
.side-btn:hover{background:var(--input-bg);color:var(--text);}
.side-btn.active{background:linear-gradient(135deg,rgba(45,90,39,.15),rgba(45,90,39,.08));color:var(--accent);font-weight:600;}
.side-version{margin-top:auto;font-size:.75rem;color:var(--text2);padding:8px 8px 0;opacity:.6;}

/* Bottom nav (mobile) */
#bottomnav{
  display:none;justify-content:space-around;background:var(--nav-bg);
  box-shadow:0 -2px 16px rgba(0,0,0,.08);flex-shrink:0;
  padding-bottom:env(safe-area-inset-bottom,0);
}
.bnav-btn{background:none;border:none;color:var(--text2);display:flex;flex-direction:column;align-items:center;font-size:.65rem;font-family:inherit;font-weight:500;cursor:pointer;padding:8px 6px;flex:1;gap:3px;transition:.2s;}
.bnav-btn .ico{font-size:1.4rem;}
.bnav-btn.active{color:var(--accent);font-weight:700;}

/* Content */
#content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:clamp(14px,3vw,28px);}

/* Responsive switch */
@media (max-width:768px){
  #sidebar{display:none;}
  #bottomnav{display:flex;}
  #shell{flex-direction:column;}
  #content{padding:12px 12px 8px;}
}

/* ‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê */
.tab{display:none;}
.tab.active{display:block;animation:fadeIn .4s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}

/* ‚ïê‚ïê‚ïê CARDS ‚ïê‚ïê‚ïê */
.card{background:var(--card);border-radius:var(--radius);padding:clamp(14px,2.5vw,22px);margin-bottom:14px;box-shadow:var(--shadow);border:1px solid var(--border);}
.card-sm{padding:clamp(10px,2vw,16px);border-radius:16px;}

/* Page header */
.page-title{font-size:clamp(1.3rem,4vw,2rem);font-weight:700;margin-bottom:18px;letter-spacing:-.5px;}

/* ‚ïê‚ïê‚ïê GRATITUDE ‚ïê‚ïê‚ïê */
.grat-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.grat-img{width:100%;border-radius:16px;display:block;object-fit:cover;height:clamp(130px,22vh,220px);}
.grat-sentences{text-align:left;padding:4px 0;}
.grat-line{font-weight:600;font-size:clamp(.9rem,2.5vw,1.05rem);padding:10px 0;display:flex;align-items:center;gap:10px;}
.grat-line:not(:last-child){border-bottom:1px solid var(--border);}
body.dark .grat-line{color:#e8f0e8 !important;}
.btn3d{background:linear-gradient(145deg,var(--accent2),var(--accent));color:#fff;border:none;border-radius:14px;padding:11px 18px;font-size:clamp(.8rem,2vw,.95rem);font-weight:700;font-family:inherit;cursor:pointer;box-shadow:0 5px 0 #1a3a17,0 8px 16px rgba(0,0,0,.25);transform:translateY(0);transition:transform .1s,box-shadow .1s;}
.btn3d:active{transform:translateY(4px);box-shadow:0 1px 0 #1a3a17,0 4px 8px rgba(0,0,0,.2);}

/* ‚ïê‚ïê‚ïê CALM ‚ïê‚ïê‚ïê */
#tab-calm{
  background:#0d1f0d;
  background-image: url('https://picsum.photos/id/15/1200/800');
  background-size:cover;background-position:center;
  border-radius:var(--radius);padding:clamp(14px,3vw,24px);min-height:calc(100vh - 160px);
  position:relative;overflow:hidden;
}
#tab-calm::before{
  content:'';position:absolute;inset:0;
  background:rgba(5,20,5,0.62);
  border-radius:var(--radius);
  pointer-events:none;
}
@media(max-width:768px){#tab-calm{min-height:auto;background-size:cover;}}
.calm-title{color:#c8f0a0;font-size:clamp(1.2rem,3.5vw,1.8rem);font-weight:700;text-align:center;margin-bottom:6px;position:relative;}
#timer-disp{font-size:clamp(2.2rem,8vw,4rem);font-weight:700;color:#a8e87c;text-align:center;letter-spacing:2px;text-shadow:0 0 30px rgba(140,230,80,.5);margin:4px 0;position:relative;}
#breath-lbl{font-size:clamp(.95rem,2.8vw,1.2rem);font-weight:600;color:#b8e89c;text-align:center;min-height:26px;margin:4px 0;transition:color .5s;position:relative;}

/* Breath circle */
.breath-wrap{position:relative;margin:10px auto;width:clamp(140px,30vw,210px);height:clamp(140px,30vw,210px);display:none;align-items:center;justify-content:center;}
.breath-wrap.show{display:flex;}
.b-ring{position:absolute;border-radius:50%;width:100%;height:100%;
  background:radial-gradient(circle at 33% 33%,#c8f5a0,#3a8020 55%,#1a4010);
  box-shadow:0 0 50px rgba(140,230,80,.4),0 0 100px rgba(100,180,50,.15),inset 0 -10px 25px rgba(0,0,0,.35),inset 0 10px 25px rgba(255,255,255,.12);}
.b-shine{position:absolute;border-radius:50%;width:58%;height:58%;background:radial-gradient(circle at 33% 33%,rgba(255,255,255,.28),transparent 65%);}
.b-txt{position:relative;z-index:2;color:#fff;font-weight:700;font-size:clamp(.8rem,2.2vw,1rem);text-align:center;text-shadow:0 2px 6px rgba(0,0,0,.5);white-space:pre-line;font-family:inherit;}

@keyframes bIn{from{transform:scale(.55);box-shadow:0 0 20px rgba(140,230,80,.2),inset 0 -10px 25px rgba(0,0,0,.35);}to{transform:scale(1);box-shadow:0 0 70px rgba(140,230,80,.7),0 0 120px rgba(100,180,50,.2),inset 0 -10px 25px rgba(0,0,0,.35);}}
@keyframes bHold{0%,100%{transform:scale(1);box-shadow:0 0 70px rgba(140,230,80,.7),inset 0 -10px 25px rgba(0,0,0,.35);}}
@keyframes bOut{from{transform:scale(1);box-shadow:0 0 70px rgba(140,230,80,.7),inset 0 -10px 25px rgba(0,0,0,.35);}to{transform:scale(.55);box-shadow:0 0 20px rgba(140,230,80,.2),inset 0 -10px 25px rgba(0,0,0,.35);}}

/* Manual time */
.time-ctrl-panel{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:16px;padding:14px 16px;margin:12px 0;position:relative;}
.time-ctrl-label{color:#c8f0a0;font-size:.85rem;font-weight:600;text-transform:uppercase;letter-spacing:.6px;margin-bottom:10px;text-align:center;}
.time-ctrl-row{display:flex;align-items:center;gap:10px;justify-content:center;}
.time-input{width:80px;padding:10px 12px;border-radius:12px;border:2px solid rgba(255,255,255,.3);background:rgba(255,255,255,.12);color:#fff;font-size:1.3rem;font-family:inherit;font-weight:700;text-align:center;transition:.2s;}
.time-input:focus{outline:none;border-color:#a8e87c;background:rgba(255,255,255,.18);}
.time-input::placeholder{color:rgba(255,255,255,.4);}
.time-start-btn{padding:11px 20px;border-radius:14px;border:none;background:linear-gradient(145deg,#5aaa3a,#3a8020);color:#fff;font-family:inherit;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 4px 0 #1a5010,0 6px 12px rgba(0,0,0,.3);transform:translateY(0);transition:.1s;white-space:nowrap;}
.time-start-btn:active{transform:translateY(3px);box-shadow:0 1px 0 #1a5010;}
.time-stop-btn{padding:11px 16px;border-radius:14px;border:1.5px solid rgba(255,120,120,.5);background:rgba(255,80,80,.12);color:#fca5a5;font-family:inherit;font-weight:700;font-size:1rem;cursor:pointer;transition:.2s;white-space:nowrap;}
.time-stop-btn:active{background:rgba(255,80,80,.25);}
.time-label{color:#b8e89c;font-size:.9rem;flex-shrink:0;}

/* Sound controls */
.sound-panel{background:rgba(255,255,255,.07);border-radius:14px;padding:12px 14px;margin:10px 0;position:relative;}
.sound-row{display:flex;align-items:center;gap:10px;padding:6px 0;}
.sound-row:not(:last-child){border-bottom:1px solid rgba(255,255,255,.06);}
.snd-label{color:#b8e89c;font-size:.9rem;width:90px;flex-shrink:0;}
.snd-toggle{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;padding:4px 14px;border-radius:20px;cursor:pointer;font-size:.82rem;font-family:inherit;white-space:nowrap;transition:.2s;}
.snd-toggle.on{background:rgba(140,230,80,.25);border-color:rgba(140,230,80,.4);color:#a8e87c;}
input[type=range]{flex:1;accent-color:#a8e87c;height:4px;}

.calm-btns{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;}
.calm-btn{flex:1;min-width:70px;padding:10px 6px;border-radius:12px;border:none;font-family:inherit;font-weight:600;font-size:.9rem;cursor:pointer;background:rgba(255,255,255,.12);color:#cce8ff;transition:.2s;}
.calm-btn:active{opacity:.7;}
.calm-btn.stop{background:rgba(255,100,100,.15);color:#fca5a5;}
.calm-btn.start-custom{background:rgba(125,212,252,.2);color:#7dd4fc;}

/* ‚ïê‚ïê‚ïê PEPP ‚ïê‚ïê‚ïê */
.pepp-stars{display:flex;justify-content:center;gap:8px;margin-bottom:10px;}
.p-star{font-size:1.3rem;animation:twinkle 2.2s infinite ease-in-out;}
.p-star:nth-child(2){animation-delay:.35s;}.p-star:nth-child(3){animation-delay:.7s;}
@keyframes twinkle{0%,100%{opacity:.35;transform:scale(.88);}50%{opacity:1;transform:scale(1.18);}}
.pepp-card{background:linear-gradient(145deg,#163320,#2d5a27);border-radius:22px;padding:clamp(20px,4vw,34px);margin-bottom:16px;position:relative;overflow:hidden;box-shadow:0 12px 40px rgba(45,90,39,.35),inset 0 1px 0 rgba(255,255,255,.08);}
.pepp-card::before{content:'';position:absolute;top:-50px;right:-50px;width:180px;height:180px;border-radius:50%;background:rgba(255,255,255,.04);}
.pepp-card::after{content:'';position:absolute;bottom:-40px;left:-40px;width:140px;height:140px;border-radius:50%;background:rgba(255,255,255,.03);}
.pepp-emoji{font-size:clamp(2rem,5vw,2.8rem);display:block;margin-bottom:10px;}
#quote-txt{font-style:italic;font-size:clamp(1rem,2.8vw,1.25rem);color:#d4f5db;font-weight:500;line-height:1.65;position:relative;z-index:1;}
.pepp-btn{background:linear-gradient(145deg,var(--accent2),var(--accent));color:#fff;border:none;border-radius:18px;padding:clamp(13px,2.5vw,17px);font-size:clamp(.95rem,2.5vw,1.1rem);font-weight:700;font-family:inherit;cursor:pointer;box-shadow:0 6px 0 #1a3a17,0 10px 24px rgba(0,0,0,.2);transform:translateY(0);transition:.1s;width:100%;}
.pepp-btn:active{transform:translateY(5px);box-shadow:0 1px 0 #1a3a17;}

/* ‚ïê‚ïê‚ïê ALLM√ÑNT (ny flik) ‚ïê‚ïê‚ïê */
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-bottom:14px;}
.info-card{background:var(--card);border-radius:var(--radius);padding:clamp(14px,2.5vw,22px);box-shadow:var(--shadow);border:1px solid var(--border);text-align:center;}
.info-icon{font-size:2rem;margin-bottom:8px;}
.info-label{font-size:.8rem;color:var(--text2);font-weight:500;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;}
.info-value{font-size:1.8rem;font-weight:700;color:var(--accent);}
.info-sub{font-size:.8rem;color:var(--text2);margin-top:2px;}
.el-zone{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:10px;}
.zone-btn{padding:5px 14px;border-radius:10px;border:1.5px solid var(--border);background:none;color:var(--text2);font-family:inherit;font-size:.85rem;cursor:pointer;transition:.2s;}
.zone-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.stat-list{list-style:none;}
.stat-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border);font-size:.95rem;}
.stat-item:last-child{border-bottom:none;}
.stat-val{font-weight:700;color:var(--accent);}
.streak-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;padding:6px 14px;border-radius:20px;font-weight:700;font-size:.9rem;margin-top:8px;}

/* ‚ïê‚ïê‚ïê INST√ÑLLNINGAR ‚ïê‚ïê‚ïê */
.s-card{background:var(--card);border-radius:var(--radius);padding:clamp(14px,2.5vw,22px);margin-bottom:14px;box-shadow:var(--shadow);border:1px solid var(--border);}
.s-card h3{margin:0 0 12px;color:var(--accent);font-size:1rem;font-weight:700;}
.s-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);}
.s-row:last-child{border-bottom:none;}
.s-lbl{font-size:clamp(.88rem,2.5vw,1rem);color:var(--text);}
.toggle{position:relative;width:50px;height:28px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.slider{position:absolute;cursor:pointer;inset:0;background:#ccc;border-radius:28px;transition:.3s;}
.slider:before{content:"";position:absolute;width:20px;height:20px;left:4px;bottom:4px;background:#fff;border-radius:50%;transition:.3s;}
input:checked+.slider{background:var(--accent);}
input:checked+.slider:before{transform:translateX(22px);}

/* Theme selector */
.theme-sel{display:flex;gap:8px;flex-wrap:wrap;}
.theme-opt{flex:1;min-width:80px;padding:10px 6px;border-radius:12px;border:2px solid var(--border);background:var(--input-bg);color:var(--text2);font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;text-align:center;transition:.2s;}
.theme-opt.active{border-color:var(--accent);color:var(--accent);background:rgba(45,90,39,.08);}

.input-row{display:flex;gap:8px;margin-top:10px;}
.txt-in{flex:1;padding:11px 14px;border-radius:12px;border:1.5px solid var(--border);background:var(--input-bg);color:var(--text);font-size:.9rem;font-family:inherit;}
.txt-in:focus{outline:none;border-color:var(--accent);}
.add-btn{padding:11px 16px;border-radius:12px;border:none;background:var(--accent);color:#fff;font-weight:700;font-family:inherit;cursor:pointer;white-space:nowrap;}
.item-list{margin-top:10px;max-height:200px;overflow-y:auto;}
.list-item{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-radius:10px;margin-bottom:6px;background:var(--input-bg);font-size:.88rem;}
.del-btn{background:none;border:none;color:#ef5350;cursor:pointer;font-size:1.1rem;padding:0 4px;}

/* Mantra card */
.mantra-card{background:linear-gradient(145deg,#0d2010,#1a3a1a);border:1px solid rgba(140,230,80,.2);border-radius:22px;padding:clamp(18px,3.5vw,28px);margin-top:16px;box-shadow:0 8px 32px rgba(0,0,0,.25),inset 0 1px 0 rgba(255,255,255,.06);}
.mantra-icon{font-size:2rem;text-align:center;display:block;margin-bottom:8px;}
.mantra-title{text-align:center;font-size:.8rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:rgba(200,240,150,.6);margin-bottom:14px;}
.mantra-line{font-size:clamp(.9rem,2.5vw,1.05rem);line-height:1.75;color:#d4f5d0;font-style:italic;font-weight:400;text-align:center;}
.mantra-closing{font-weight:600;font-style:normal;color:#c8f0a0;margin-top:4px;}
.mantra-divider{width:40px;height:2px;background:rgba(140,230,80,.25);border-radius:2px;margin:12px auto;}


.help-search-wrap{position:relative;margin-bottom:16px;}
.help-search{width:100%;padding:12px 16px 12px 44px;border-radius:14px;border:1.5px solid var(--border);background:var(--card);color:var(--text);font-family:inherit;font-size:1rem;box-shadow:var(--shadow);}
.help-search:focus{outline:none;border-color:var(--accent);}
.help-search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:1.1rem;pointer-events:none;}
.help-cats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.help-cat{padding:6px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--card);color:var(--text2);font-family:inherit;font-size:.82rem;font-weight:600;cursor:pointer;transition:.2s;}
.help-cat.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.help-section{margin-bottom:10px;}
.help-section-title{font-size:1rem;font-weight:700;color:var(--accent);padding:14px 18px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.help-item{padding:12px 18px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .2s;}
.help-item:hover{background:var(--input-bg);}
.help-item:last-child{border-bottom:none;}
.help-item-title{font-weight:600;font-size:.95rem;margin-bottom:4px;color:var(--text);}
.help-item-preview{font-size:.82rem;color:var(--text2);line-height:1.5;}
.help-detail{display:none;padding:16px 18px;background:var(--input-bg);border-radius:0 0 16px 16px;}
.help-detail.open{display:block;animation:fadeIn .3s ease;}
.help-detail-text{font-size:.9rem;line-height:1.7;color:var(--text);}
.help-detail-text strong{color:var(--accent);}
.help-tag{display:inline-block;background:rgba(45,90,39,.12);color:var(--accent);border-radius:8px;padding:2px 8px;font-size:.75rem;font-weight:600;margin-right:4px;margin-bottom:4px;}
body.dark .help-tag{background:rgba(76,175,80,.15);}
.no-results{text-align:center;padding:40px 20px;color:var(--text2);font-size:.95rem;}
</style>
</head>
<body>

<!-- LOCK / PIN SETUP -->
<div id="lock">
  <!-- Normal unlock view -->
  <div id="lock-unlock">
    <div class="lock-icon">üîí</div>
    <div class="lock-title">Min V√§lm√•ende-app</div>
    <div class="lock-sub">Ange din PIN-kod</div>
    <div class="pin-dots">
      <div class="pin-dot" id="d0"></div><div class="pin-dot" id="d1"></div>
      <div class="pin-dot" id="d2"></div><div class="pin-dot" id="d3"></div>
      <div class="pin-dot" id="d4"></div><div class="pin-dot" id="d5"></div>
    </div>
    <div class="lock-err" id="lock-err"></div>
    <div class="numpad">
      <button class="nbtn" onclick="pp('1')">1</button>
      <button class="nbtn" onclick="pp('2')">2</button>
      <button class="nbtn" onclick="pp('3')">3</button>
      <button class="nbtn" onclick="pp('4')">4</button>
      <button class="nbtn" onclick="pp('5')">5</button>
      <button class="nbtn" onclick="pp('6')">6</button>
      <button class="nbtn" onclick="pp('7')">7</button>
      <button class="nbtn" onclick="pp('8')">8</button>
      <button class="nbtn" onclick="pp('9')">9</button>
      <button class="nbtn empty"></button>
      <button class="nbtn" onclick="pp('0')">0</button>
      <button class="nbtn" onclick="pd()">‚å´</button>
    </div>
    <button class="faceid-btn hidden" id="faceid-btn" onclick="tryBio()">Face ID / Touch ID</button>
  </div>

  <!-- First-time PIN setup view -->
  <div id="lock-setup" style="display:none;flex-direction:column;align-items:center;gap:18px;">
    <div class="lock-icon">üëã</div>
    <div class="lock-title">V√§lkommen!</div>
    <div class="lock-sub" id="setup-sub">Det verkar vara f√∂rsta g√•ngen. V√§lj en PIN-kod (6 siffror).</div>
    <div class="pin-dots">
      <div class="pin-dot" id="s0"></div><div class="pin-dot" id="s1"></div>
      <div class="pin-dot" id="s2"></div><div class="pin-dot" id="s3"></div>
      <div class="pin-dot" id="s4"></div><div class="pin-dot" id="s5"></div>
    </div>
    <div class="lock-err" id="setup-err"></div>
    <div class="numpad">
      <button class="nbtn" onclick="sp('1')">1</button>
      <button class="nbtn" onclick="sp('2')">2</button>
      <button class="nbtn" onclick="sp('3')">3</button>
      <button class="nbtn" onclick="sp('4')">4</button>
      <button class="nbtn" onclick="sp('5')">5</button>
      <button class="nbtn" onclick="sp('6')">6</button>
      <button class="nbtn" onclick="sp('7')">7</button>
      <button class="nbtn" onclick="sp('8')">8</button>
      <button class="nbtn" onclick="sp('9')">9</button>
      <button class="nbtn empty"></button>
      <button class="nbtn" onclick="sp('0')">0</button>
      <button class="nbtn" onclick="spd()">‚å´</button>
    </div>
  </div>
</div>

<!-- SHELL -->
<div id="shell">

  <!-- SIDEBAR (iPad/desktop) -->
  <nav id="sidebar">
    <div class="side-logo">üåø V√§lm√•ende</div>
    <button class="side-btn active" onclick="showTab('gratitude',this)" id="sb-gratitude">
      <span class="ico">‚ô•</span> Tacksamhet
    </button>
    <button class="side-btn" onclick="showTab('calm',this)" id="sb-calm">
      <span class="ico">üßò</span> Lugn & Ro
    </button>
    <button class="side-btn" onclick="showTab('inspire',this)" id="sb-inspire">
      <span class="ico">‚ú®</span> Pepp
    </button>
    <button class="side-btn" onclick="showTab('help',this)" id="sb-help">
      <span class="ico">üß†</span> Hj√§lp
    </button>
    <button class="side-btn" onclick="showTab('stats',this)" id="sb-stats">
      <span class="ico">üìä</span> Statistik
    </button>
    <button class="side-btn" onclick="showTab('general',this)" id="sb-general">
      <span class="ico">üìä</span> Allm√§nt
    </button>
    <button class="side-btn" onclick="showTab('settings',this)" id="sb-settings">
      <span class="ico">‚öôÔ∏è</span> Inst√§llningar
    </button>
    <div class="side-version">v2.0 ¬∑ jouhil.github.io</div>
  </nav>

  <!-- CONTENT -->
  <div id="content">

    <!-- TAB: TACKSAMHET -->
    <div id="tab-gratitude" class="tab active">
      <div class="grat-header">
        <div class="page-title">Dagens Tacksamhet</div>
        <button class="btn3d" onclick="renderGratitude()">Nya tankar ‚ú®</button>
      </div>
      <div id="grat-cont"></div>
    </div>

    <!-- TAB: LUGN -->
    <div id="tab-calm" class="tab">
      <div class="calm-title">üåä Lugn & Ro</div>
      <div id="timer-disp">00:00</div>
      <div id="breath-lbl">V√§lj tid och starta</div>

      <div class="breath-wrap" id="bwrap">
        <div class="b-ring" id="bring"></div>
        <div class="b-shine"></div>
        <div class="b-txt" id="btxt"></div>
      </div>

      <div class="time-ctrl-panel">
        <div class="time-ctrl-label">‚è± Ange antal minuter</div>
        <div class="time-ctrl-row">
          <input type="number" class="time-input" id="custom-min" value="1" min="1" max="60" placeholder="1">
          <button class="time-start-btn" onclick="startCustom()">‚ñ∂ Starta</button>
          <button class="time-stop-btn" onclick="stopBreath()">‚èπ Stopp</button>
        </div>
      </div>

      <div class="sound-panel">
        <div class="sound-row">
          <span class="snd-label">üåßÔ∏è Regn</span>
          <button class="snd-toggle" id="rain-btn" onclick="toggleSound('rain')">AV</button>
          <input type="range" id="rain-vol" min="0" max="1" step="0.05" value="0.35" oninput="setVol('rain',this.value)">
        </div>
        <div class="sound-row">
          <span class="snd-label">üåä Hav</span>
          <button class="snd-toggle" id="ocean-btn" onclick="toggleSound('ocean')">AV</button>
          <input type="range" id="ocean-vol" min="0" max="1" step="0.05" value="0.35" oninput="setVol('ocean',this.value)">
        </div>
        <div class="sound-row">
          <span class="snd-label">üå≤ Skog</span>
          <button class="snd-toggle" id="forest-btn" onclick="toggleSound('forest')">AV</button>
          <input type="range" id="forest-vol" min="0" max="1" step="0.05" value="0.35" oninput="setVol('forest',this.value)">
        </div>
        <div class="sound-row">
          <span class="snd-label">üü§ Brunt brus</span>
          <button class="snd-toggle" id="brown-btn" onclick="toggleSound('brown')">AV</button>
          <input type="range" id="brown-vol" min="0" max="1" step="0.05" value="0.35" oninput="setVol('brown',this.value)">
        </div>
      </div>
    </div>

    <!-- TAB: PEPP -->
    <div id="tab-inspire" class="tab">
      <div class="page-title">‚ú® Inspiration</div>
      <div class="pepp-stars">
        <span class="p-star">‚≠ê</span><span class="p-star">‚ú®</span><span class="p-star">‚≠ê</span>
      </div>
      <div class="pepp-card">
        <span class="pepp-emoji" id="pepp-emoji">üíö</span>
        <p id="quote-txt">Tryck p√• knappen f√∂r din dagliga dos pepp!</p>
      </div>
      <button class="pepp-btn" onclick="newQuote()">‚ö° Ge mig pepp!</button>

      <div class="mantra-card">
        <div class="mantra-icon">üåÖ</div>
        <h3 class="mantra-title">Dagens intention</h3>
        <p class="mantra-line">Detta kommer bli den b√§sta dagen i mitt liv ‚Äî inte f√∂r att det √§r perfekt, utan f√∂r att jag kommer fullt n√§rvarande och l√§r mig vad dagen medf√∂r.</p>
        <div class="mantra-divider"></div>
        <p class="mantra-line">Jag kontrollerar min tanke ‚Äî den kontrollerar inte mig. Jag kontrollerar inte vad som h√§nder, men jag kontrollerar hur jag agerar och hur jag v√§ljer att svara ‚Äî med gl√§dje och k√§rlek, vad som √§n h√§nder.</p>
        <div class="mantra-divider"></div>
        <p class="mantra-line mantra-closing">Glad f√∂r vad jag har nu, √§ven om det √§r n√•got litet ‚Äî √§ven om dagen inte √§r perfekt. üåø</p>
      </div>
    </div>

    <!-- TAB: HJ√ÑLP -->
    <div id="tab-help" class="tab">
      <div class="page-title">üß† Hj√§lp & Sj√§lvhj√§lp</div>

      <div class="help-search-wrap">
        <span class="help-search-icon">üîç</span>
        <input type="search" class="help-search" id="help-search" placeholder="S√∂k t.ex. negativa tankar, √•ngest, sj√§lvkritik..." oninput="filterHelp(this.value)">
      </div>

      <div class="help-cats">
        <button class="help-cat active" onclick="filterCat('all',this)">Allt</button>
        <button class="help-cat" onclick="filterCat('tankar',this)">Tankar</button>
        <button class="help-cat" onclick="filterCat('tankefallor',this)">Tankef√§llor</button>
        <button class="help-cat" onclick="filterCat('verktyg',this)">Verktyg</button>
      </div>

      <div id="help-results"></div>
    </div>

    <!-- TAB: ALLM√ÑNT -->
    <div id="tab-general" class="tab">
      <div class="page-title">‚ö° Allm√§nt</div>

      <!-- El-pris -->
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
          <strong>‚ö° Elpris just nu</strong>
          <button onclick="fetchEl()" style="background:none;border:none;cursor:pointer;font-size:1.1rem;" title="Uppdatera">üîÑ</button>
        </div>
        <div class="info-grid" style="margin-bottom:8px;">
          <div class="info-card card-sm">
            <div class="info-icon">‚ö°</div>
            <div class="info-label">Spotpris nu</div>
            <div class="info-value" id="el-now">‚Äì</div>
            <div class="info-sub">√∂re/kWh (ex. moms)</div>
          </div>
          <div class="info-card card-sm">
            <div class="info-icon">üè∑Ô∏è</div>
            <div class="info-label">Med moms + Tibber</div>
            <div class="info-value" id="el-total">‚Äì</div>
            <div class="info-sub">√∂re/kWh (inkl. allt)</div>
          </div>
          <div class="info-card card-sm">
            <div class="info-icon">üìâ</div>
            <div class="info-label">L√§gst idag</div>
            <div class="info-value" id="el-low">‚Äì</div>
            <div class="info-sub">√∂re/kWh ¬∑ kl. <span id="el-low-time">‚Äì</span></div>
          </div>
          <div class="info-card card-sm">
            <div class="info-icon">üìà</div>
            <div class="info-label">H√∂gst idag</div>
            <div class="info-value" id="el-high">‚Äì</div>
            <div class="info-sub">√∂re/kWh ¬∑ kl. <span id="el-high-time">‚Äì</span></div>
          </div>
        </div>
        <div style="background:var(--input-bg);border-radius:12px;padding:10px 14px;font-size:.82rem;color:var(--text2);margin-bottom:8px;">
          üí° <strong>Tibber-p√•slag:</strong> 7,50 √∂re/kWh + 25% moms p√• spotpris. Formel: (spotpris √ó 1,25) + 7,50
        </div>
        <!-- Prisgraf -->
        <div style="margin-bottom:8px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="font-size:.85rem;font-weight:600;color:var(--text);">üìâ Prisgraf idag (√∂re/kWh ex. moms)</div>
            <div id="chart-tooltip" style="font-size:.82rem;font-weight:700;color:var(--accent);display:none;"></div>
          </div>
          <div style="position:relative;">
            <canvas id="el-chart" style="width:100%;height:170px;border-radius:12px;display:block;cursor:crosshair;touch-action:none;"></canvas>
          </div>
          <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
            <span style="font-size:.75rem;color:var(--text2);">00:00</span>
            <input type="range" id="chart-hour-slider" min="0" max="23" value="0" style="flex:1;accent-color:var(--accent);" oninput="onChartSlider(this.value)">
            <span style="font-size:.75rem;color:var(--text2);">23:00</span>
          </div>
          <div style="font-size:.72rem;color:var(--text2);text-align:center;margin-top:2px;">üëÜ Dra i reglaget eller tryck p√• grafen f√∂r att se priset vid en viss tid</div>
        </div>
        <div class="el-zone">
          <span style="font-size:.85rem;color:var(--text2);">Zon:</span>
          <button class="zone-btn" onclick="setZone('SE1',this)">SE1</button>
          <button class="zone-btn" onclick="setZone('SE2',this)">SE2</button>
          <button class="zone-btn active" onclick="setZone('SE3',this)">SE3</button>
          <button class="zone-btn" onclick="setZone('SE4',this)">SE4</button>
        </div>
        <div style="font-size:.75rem;color:var(--text2);margin-top:8px;text-align:center;" id="el-updated"></div>
      </div>
    </div>

    <!-- TAB: STATISTIK -->
    <div id="tab-stats" class="tab">
      <div class="page-title">üìä Statistik</div>

      <!-- Dagligt fokus -->
      <div class="card" style="margin-bottom:14px;">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
          <span style="font-size:1.4rem;">üéØ</span>
          <div>
            <strong style="display:block;">Dagens avsikt</strong>
            <span style="font-size:.8rem;color:var(--text2);">Vad vill du fokusera p√• idag?</span>
          </div>
        </div>
        <div id="focus-display" style="display:none;background:linear-gradient(135deg,rgba(45,90,39,.1),rgba(45,90,39,.05));border:1px solid rgba(45,90,39,.2);border-radius:12px;padding:12px 14px;margin-bottom:10px;font-style:italic;font-size:.95rem;color:var(--text);line-height:1.6;"></div>
        <div style="display:flex;gap:8px;">
          <input type="text" class="txt-in" id="focus-input" placeholder="Skriv din avsikt f√∂r dagen..." maxlength="140" style="flex:1;">
          <button class="add-btn" onclick="saveFocus()">Spara</button>
        </div>
        <div style="font-size:.75rem;color:var(--text2);margin-top:6px;text-align:right;" id="focus-date"></div>
      </div>

      <!-- Statistik -->
      <div class="card">
        <strong>üìà Din anv√§ndning</strong>
        <ul class="stat-list" style="margin-top:12px;">
          <li class="stat-item"><span>üßò Andningsminuter totalt</span><span class="stat-val" id="st-breath">0 min</span></li>
          <li class="stat-item"><span>‚ô• Tacksamheter visade</span><span class="stat-val" id="st-grat">0</span></li>
          <li class="stat-item"><span>‚ö° Pepp-citat l√§sta</span><span class="stat-val" id="st-pepp">0</span></li>
          <li class="stat-item"><span>üìÖ Dagar i rad (streak)</span><span class="stat-val" id="st-streak">0</span></li>
        </ul>
        <div style="text-align:center;margin-top:10px;">
          <span class="streak-badge" id="streak-badge">üî• 0 dagars streak</span>
        </div>
        <button onclick="resetStats()" style="margin-top:12px;background:none;border:1.5px solid var(--border);color:var(--text2);padding:6px 16px;border-radius:10px;font-family:inherit;font-size:.82rem;cursor:pointer;width:100%;">Nollst√§ll statistik</button>
      </div>
    </div>

    <!-- TAB: INST√ÑLLNINGAR -->
    <div id="tab-settings" class="tab">
      <div class="page-title">‚öôÔ∏è Inst√§llningar</div>
      <div id="screen-info"></div>

      <div class="s-card">
        <h3>üé® Tema</h3>
        <div class="theme-sel">
          <button class="theme-opt" id="th-light" onclick="setTheme('light')">‚òÄÔ∏è Ljust</button>
          <button class="theme-opt" id="th-dark" onclick="setTheme('dark')">üåô M√∂rkt</button>
          <button class="theme-opt active" id="th-auto" onclick="setTheme('auto')">üåó Auto (19‚Äì07)</button>
        </div>
      </div>

      <div class="s-card">
        <h3>üîí S√§kerhet</h3>
        <div class="s-row">
          <span class="s-lbl">Face ID / Touch ID</span>
          <label class="toggle"><input type="checkbox" id="bioToggle" onchange="onBioToggle(this.checked)"><span class="slider"></span></label>
        </div>
        <div class="s-row">
          <span class="s-lbl">√Ñndra PIN-kod</span>
          <button onclick="changePin()" style="padding:6px 14px;border-radius:10px;border:1.5px solid var(--border);background:none;color:var(--text2);font-family:inherit;font-size:.85rem;cursor:pointer;">√Ñndra ‚Üí</button>
        </div>
      </div>

      <div class="s-card">
        <h3>‚ô• Egna tacksamhetstexter</h3>
        <div class="input-row">
          <input type="text" class="txt-in" id="newGratIn" placeholder="T.ex. Tacksam f√∂r solen..." maxlength="120">
          <button class="add-btn" onclick="addGrat()">+ L√§gg till</button>
        </div>
        <div class="item-list" id="grat-list"></div>
      </div>

      <div class="s-card">
        <h3>‚ú® Egna inspirationscitat</h3>
        <div class="input-row">
          <input type="text" class="txt-in" id="newQuoteIn" placeholder="T.ex. Du √§r stark nog!" maxlength="160">
          <button class="add-btn" onclick="addQuote()">+ L√§gg till</button>
        </div>
        <div class="item-list" id="quote-list"></div>
      </div>
    </div>

  </div><!-- /content -->

  <!-- BOTTOM NAV (mobile) -->
  <nav id="bottomnav">
    <button class="bnav-btn active" onclick="showTab('gratitude',this)"><span class="ico">‚ô•</span>Tacksam</button>
    <button class="bnav-btn" onclick="showTab('calm',this)"><span class="ico">üßò</span>Lugn</button>
    <button class="bnav-btn" onclick="showTab('inspire',this)"><span class="ico">‚ú®</span>Pepp</button>
    <button class="bnav-btn" onclick="showTab('help',this)"><span class="ico">üß†</span>Hj√§lp</button>
    <button class="bnav-btn" onclick="showTab('stats',this)"><span class="ico">üìä</span>Statistik</button>
    <button class="bnav-btn" onclick="showTab('general',this)"><span class="ico">‚ö°</span>Allm√§nt</button>
    <button class="bnav-btn" onclick="showTab('settings',this)"><span class="ico">‚öôÔ∏è</span>Inst√§lln.</button>
  </nav>

</div><!-- /shell -->

<script>
// ‚ïê‚ïê‚ïê PIN ‚Äì dynamisk (sparas i localStorage) ‚ïê‚ïê‚ïê
let SAVED_PIN = localStorage.getItem('userPin') || null;
let pe = '';
let setupStep = 0; // 0=v√§lj ny, 1=bekr√§fta
let setupFirst = '';

function initLock(){
  if(!SAVED_PIN){
    // F√∂rsta g√•ngen ‚Äì visa setup
    document.getElementById('lock-unlock').style.display='none';
    const s=document.getElementById('lock-setup');
    s.style.display='flex';
  } else {
    const bioOn=localStorage.getItem('bioOn')==='1';
    if(bioOn){document.getElementById('faceid-btn').classList.remove('hidden');setTimeout(tryBio,400);}
  }
}

// Normal unlock
function ud(){for(let i=0;i<6;i++){const d=document.getElementById('d'+i);d.classList.remove('filled','error');if(i<pe.length)d.classList.add('filled');}}
function pp(digit){if(pe.length>=6)return;pe+=digit;ud();document.getElementById('lock-err').innerText='';if(pe.length===6)setTimeout(chkPin,150);}
function pd(){pe=pe.slice(0,-1);ud();document.getElementById('lock-err').innerText='';}
function chkPin(){
  if(pe===SAVED_PIN){unlock();return;}
  for(let i=0;i<6;i++){document.getElementById('d'+i).classList.remove('filled');document.getElementById('d'+i).classList.add('error');}
  document.getElementById('lock-err').innerText='Fel PIN-kod, f√∂rs√∂k igen';
  setTimeout(()=>{for(let i=0;i<6;i++)document.getElementById('d'+i).classList.remove('error');pe='';ud();},800);
}
function unlock(){document.getElementById('lock').classList.add('hidden');updateStreak();loadFocus();}

// PIN setup ‚Äì f√∂rsta g√•ngen
let se='';
function sudDots(){for(let i=0;i<6;i++){const d=document.getElementById('s'+i);d.classList.remove('filled','error');if(i<se.length)d.classList.add('filled');}}
function sp(digit){if(se.length>=6)return;se+=digit;sudDots();document.getElementById('setup-err').innerText='';if(se.length===6)setTimeout(checkSetup,150);}
function spd(){se=se.slice(0,-1);sudDots();}
function checkSetup(){
  if(setupStep===0){
    // Steg 1: spara f√∂rsta f√∂rs√∂ket
    setupFirst=se;se='';sudDots();
    setupStep=1;
    document.getElementById('setup-sub').innerText='Ange samma PIN igen f√∂r att bekr√§fta.';
    document.getElementById('setup-err').innerText='';
  } else {
    // Steg 2: bekr√§fta
    if(se===setupFirst){
      SAVED_PIN=se;
      localStorage.setItem('userPin',SAVED_PIN);
      document.getElementById('lock-setup').style.display='none';
      document.getElementById('lock-unlock').style.display='flex';
      // Logga in direkt
      unlock();
    } else {
      for(let i=0;i<6;i++){document.getElementById('s'+i).classList.add('error');}
      document.getElementById('setup-err').innerText='PIN-koderna st√§mmer inte. F√∂rs√∂k igen.';
      setTimeout(()=>{
        for(let i=0;i<6;i++)document.getElementById('s'+i).classList.remove('error');
        setupStep=0;setupFirst='';se='';sudDots();
        document.getElementById('setup-sub').innerText='Det verkar vara f√∂rsta g√•ngen. V√§lj en PIN-kod (6 siffror).';
      },900);
    }
  }
}

// ‚ïê‚ïê‚ïê BIOMETRICS ‚ïê‚ïê‚ïê
async function tryBio(){
  if(!window.PublicKeyCredential){document.getElementById('lock-err').innerText='Biometri ej tillg√§nglig';return;}
  const cid=localStorage.getItem('bioCred');
  if(!cid){document.getElementById('lock-err').innerText='Aktivera Face ID i Inst√§llningar';return;}
  try{
    const ch=new Uint8Array(32);crypto.getRandomValues(ch);
    const a=await navigator.credentials.get({publicKey:{challenge:ch,allowCredentials:[{id:b64toBuf(cid),type:'public-key',transports:['internal']}],userVerification:'required',timeout:60000}});
    if(a)unlock();
  }catch(e){document.getElementById('lock-err').innerText='Biometri misslyckades, ange PIN';}
}
async function regBio(){
  if(!window.PublicKeyCredential){alert('Face ID st√∂ds ej');document.getElementById('bioToggle').checked=false;return;}
  try{
    const ch=new Uint8Array(32);crypto.getRandomValues(ch);
    const uid=new Uint8Array(16);crypto.getRandomValues(uid);
    const c=await navigator.credentials.create({publicKey:{challenge:ch,rp:{name:'V√§lm√•ende-app'},user:{id:uid,name:'user',displayName:'Anv√§ndare'},pubKeyCredParams:[{type:'public-key',alg:-7}],authenticatorSelection:{authenticatorAttachment:'platform',userVerification:'required'},timeout:60000}});
    localStorage.setItem('bioCred',bufToB64(c.rawId));localStorage.setItem('bioOn','1');
    document.getElementById('faceid-btn').classList.remove('hidden');alert('Face ID aktiverat! ‚úÖ');
  }catch(e){alert('Kunde inte aktivera: '+e.message);document.getElementById('bioToggle').checked=false;}
}
function onBioToggle(on){if(on){regBio();}else{localStorage.setItem('bioOn','0');localStorage.removeItem('bioCred');document.getElementById('faceid-btn').classList.add('hidden');}}
function bufToB64(b){return btoa(String.fromCharCode(...new Uint8Array(b)));}
function b64toBuf(s){const bin=atob(s);const buf=new Uint8Array(bin.length);for(let i=0;i<bin.length;i++)buf[i]=bin.charCodeAt(i);return buf.buffer;}

// ‚ïê‚ïê‚ïê RESIZE ‚ïê‚ïê‚ïê
function resizeApp(){
  const shell=document.getElementById('shell');
  shell.style.height=window.innerHeight+'px';
}
resizeApp();
window.addEventListener('resize',resizeApp);
window.addEventListener('orientationchange',()=>setTimeout(resizeApp,300));

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const defGrat=["Tacksam f√∂r kaffet.","Tacksam f√∂r vilan.","Tacksam f√∂r v√§nner.","Tacksam f√∂r att jag har bra v√§nner", "Jag har h√§lsa och kraft i kroppen", "Tacksam f√∂r att solen g√•r upp varje morgon", "Jag har mat p√• bordet varje dag", "Tacksam f√∂r att jag har ett tak √∂ver huvudet", "Jag har m√§nniskor som bryr sig om mig", "Tacksam f√∂r att jag fick uppleva en ny dag", "Jag har f√∂rm√•gan att l√§ra mig nya saker", "Tacksam f√∂r naturen och frisk luft runt mig", "Jag har ett hj√§rta som sl√•r och lungor som andas", "Tacksam f√∂r skrattet som lyser upp dagen", "Jag har minnen som v√§rmer mitt hj√§rta", "Tacksam f√∂r att jag kan r√∂ra mig fritt", "Jag har dr√∂mmar och m√•l att str√§va mot", "Tacksam f√∂r musikens f√∂rm√•ga att lyfta mitt hum√∂r", "Jag har styrka att hantera utmaningar", "Tacksam f√∂r en varm kopp te p√• morgonen", "Jag har m√∂jlighet att v√§lja hur jag t√§nker", "Tacksam f√∂r att varje dag ger nya m√∂jligheter", "Jag har f√∂rm√•gan att k√§nna k√§rlek och gl√§dje", "Tacksam f√∂r att jag bor i ett tryggt land", "Jag har tillg√•ng till rent vatten varje dag", "Tacksam f√∂r att jag kan ge och ta emot en kram", "Jag har kreativitet och fantasi", "Tacksam f√∂r √∂gonblick av stillhet och ro", "Jag har l√§rt mig av mina misstag och blivit starkare", "Tacksam f√∂r att jag har en fungerande kropp", "Jag har tillg√•ng till utbildning och kunskap", "Tacksam f√∂r solnedg√•ngarnas sk√∂nhet", "Jag har m√∂jlighet att hj√§lpa andra", "Tacksam f√∂r att jag kan kommunicera och uttrycka mig", "Jag har hopp om en b√§ttre morgondag", "Tacksam f√∂r b√∂cker och ber√§ttelser som inspirerar", "Jag har f√∂rm√•gan att f√∂rl√•ta och g√• vidare", "Tacksam f√∂r att jag har ett arbete ett intresse att g√• till", "Jag har passion f√∂r saker som engagerar mig", "Tacksam f√∂r varje litet steg fram√•t", "Jag har f√∂rm√•ga att k√§nna tacksamhet i sig sj√§lvt", "Tacksam f√∂r regnet som ger liv √•t naturen", "Jag har erfarenheter som format mig positivt", "Tacksam f√∂r att jag kan se stj√§rnorna p√• natten", "Jag har mod att m√∂ta det ok√§nda", "Tacksam f√∂r djurens s√§llskap och gl√§dje", "Jag har en hj√§rna som kan l√∂sa problem", "Tacksam f√∂r att familjen finns i mitt liv", "Jag har m√∂jlighet att tr√§na och h√•lla mig frisk", "Tacksam f√∂r tekniken som f√∂renklar min vardag", "Jag har frihet att g√∂ra egna val", "Tacksam f√∂r att jag kan se sk√∂nhet i vardagen", "Jag har tid att vila och √•terh√§mta mig", "Tacksam f√∂r alla goda samtal jag har haft", "Jag har f√∂rm√•gan att anpassa mig och v√§xa", "Tacksam f√∂r varje g√•ng n√•gon sagt n√•got sn√§llt till mig", "Jag har resurser och verktyg f√∂r att n√• mina m√•l", "Tacksam f√∂r havet, skogen och bergen", "Jag har en r√∂st och mod att anv√§nda den", "Tacksam f√∂r att jag kan k√§nna empati f√∂r andra", "Jag har en historia att vara stolt √∂ver", "Tacksam f√∂r de utmaningar som gjort mig starkare", "Jag har m√∂jlighet att skapa n√•got meningsfullt", "Tacksam f√∂r att jag kan njuta av god mat", "Jag har v√§nner som lyssnar n√§r jag beh√∂ver det", "Tacksam f√∂r de skratt jag delar med n√§ra och k√§ra", "Jag har f√∂rm√•gan att b√∂rja om varje dag", "Tacksam f√∂r att livet ger mig nya chanser", "Jag har nyfikenhet som driver mig fram√•t", "Tacksam f√∂r de tysta stunderna som laddar batterierna", "Jag har ett leende att ge bort gratis", "Tacksam f√∂r att jag kan dr√∂mma om framtiden", "Jag har tacksamheten som g√∂r livet rikare", "Tacksam f√∂r varje andetag jag tar", "Jag har f√∂rm√•gan att se ljuset √§ven i m√∂rkret", "Tacksam f√∂r alla m√∂jligheter som √§nnu inte kommit", "Jag har k√§rlek att ge och ta emot", "Tacksam f√∂r att jag klarade ig√•r och klarar idag", "Jag har tro p√• att allt ordnar sig", "Tacksam f√∂r att jag √§r unik och v√§rdefull precis som jag √§r", "Jag har livet framf√∂r mig fullt av m√∂jligheter","Tacksam f√∂r h√§lsan.","Tacksam f√∂r att jag har Anton.","Jag har h√§lsa.","Jag har v√§nner.","Jag bor bra.","Tanke,k√§nsla och handling skapar din verklighet - t√§nk positivt det finns alltid n√•got som √§r bra!","Attjag har Pappa.","Att Anna finns n√§ra.","Att f√• √§ta gott.","Tid utan m√•sten.","En god kopp te och bulle.","Tacksam f√∂r det jag har.","Att kunna s√§ga nej. och det √§r ok","Att kunna s√§ga tack.","Stunder av lugn.","Naturen runt mig."];
const defQuotes=["Du klarar detta!","Du √§r starkare √§n du tror", "Varje dag tar jag steg mot mitt b√§sta jag", "Jag √§r kapabel att klara vad som √§n kommer", "Mina k√§nslor √§r ok, √§ven de tr√∂tta och irriterande", "Jag v√§ljer att tro p√• mig sj√§lv idag", "Varje utmaning g√∂r mig starkare", "Jag f√∂rtj√§nar att m√• bra", "Jag har klarat sv√•ra saker f√∂rut och klarar det igen", "Min energi √•terv√§nder n√§r jag tar hand om mig", "Jag √§r nog precis som jag √§r just nu", "Det √§r ok att ha en d√•lig dag, imorgon √§r ny", "Jag v√§xer varje g√•ng jag v√§ljer att forts√§tta", "Jag har allt inom mig som jag beh√∂ver", "Mina dr√∂mmar √§r v√§rda att k√§mpa f√∂r", "Jag till√•ter mig sj√§lv att vila utan skuldk√§nslor", "Varje litet framsteg r√§knas och betyder n√•got", "Jag √§r v√§rd k√§rlek och respekt", "Jag v√§ljer att fokusera p√• det jag kan p√•verka", "Min kropp g√∂r sitt b√§sta f√∂r mig varje dag", "Jag √§r modig nog att ta n√§sta steg", "Det b√§sta i mig visar sig n√§r det √§r som sv√•rast", "Jag √§r stolt √∂ver hur l√•ngt jag kommit", "Jag v√§ljer att se m√∂jligheter ist√§llet f√∂r hinder", "Jag √§r en person som g√∂r skillnad", "Min potential √§r obegr√§nsad", "Jag till√•ter mig att vara m√§nsklig och ofullst√§ndig", "Jag har mod √§ven n√§r jag √§r r√§dd", "Varje morgon √§r en ny chans att b√∂rja om", "Jag litar p√• min f√∂rm√•ga att fatta bra beslut", "Jag √§r v√§rd det b√§sta som livet har att erbjuda", "Mitt sinne √§r lugnt och mitt hj√§rta √§r starkt", "Jag v√§ljer gl√§dje, √§ven n√§r det kostar lite anstr√§ngning", "Jag √§r kapabel att l√§ra mig och v√§xa", "Jag ger mig sj√§lv till√•telse att misslyckas och f√∂rs√∂ka igen", "Jag √§r en magnet f√∂r positiva m√∂jligheter", "Det finns kraft i mig som jag √§nnu inte fullt anv√§nt", "Jag √§r viktig och min r√∂st har v√§rde", "Jag kan hantera os√§kerhet med lugn och t√•lamod", "Varje dag bygger jag ett liv jag √§r stolt √∂ver", "Jag v√§ljer att inte ge upp, inte idag", "Jag har f√∂rm√•gan att skapa f√∂r√§ndring i mitt liv", "Mina tankar formar min verklighet och jag v√§ljer positiva tankar", "Jag √§r mer √§n mina misstag", "Jag till√•ter mig att ta plats och synas", "Jag har resurser och kreativitet att l√∂sa problem", "Det √§r ok att be om hj√§lp, det √§r ett styrketecken", "Jag v√§ljer att behandla mig sj√§lv med v√§nlighet", "Jag tror p√• den process jag √§r mitt i", "Varje andetag p√•minner mig om att jag lever och har kraft", "Jag √§r p√• r√§tt v√§g, √§ven om den k√§nns l√•ng", "Jag f√∂rtj√§nar framg√•ng och lycka", "Min inre styrka √§r starkare √§n alla yttre omst√§ndigheter", "Jag √§r nyfiken och √∂ppen f√∂r nya m√∂jligheter", "Jag v√§ljer att lita p√• livet och dess riktning", "Mina svaga stunder √§r en del av min styrka", "Jag √§r tillr√§ckligt bra precis som jag √§r idag", "Jag har klarat 100% av mina sv√•raste dagar hittills", "Jag v√§ljer att leva i nuet och inte oroa mig i on√∂dan", "Jag √§r kapabel att skapa den f√∂r√§ndring jag √∂nskar", "Varje utmaning √§r en m√∂jlighet att l√§ra sig n√•got nytt", "Jag v√§ljer att fira mina framsteg, stora som sm√•", "Jag √§r omgiven av m√∂jligheter om jag v√§ljer att se dem", "Min vilja och mitt mod √§r starkare √§n min r√§dsla", "Jag ger inte upp f√∂r att det √§r sv√•rt, jag ger mig f√∂r att det √§r v√§rt det", "Jag f√∂rtj√§nar lugn, gl√§dje och inre frid", "Jag √§r i st√§ndig utveckling och det √§r n√•got att vara stolt √∂ver", "Varje dag g√∂r jag mitt b√§sta och det √§r tillr√§ckligt", "Jag v√§ljer att tro att allt √§r m√∂jligt", "Mina erfarenheter har format mig till den starka person jag √§r", "Jag √§r fri att skapa det liv jag vill leva", "Jag lyssnar p√• min kropp och ger den vad den beh√∂ver", "Jag √§r kapabel att f√∂r√§ndra det som inte tj√§nar mig l√§ngre", "Mitt mod v√§xer varje g√•ng jag m√∂ter mina r√§dslor", "Jag v√§ljer att omge mig med energi som lyfter mig", "Jag √§r v√§rd att investera tid och k√§rlek p√• mig sj√§lv", "Jag tror p√• min f√∂rm√•ga att n√• mina m√•l", "Jag √§r ett verk i framsteg och det √§r fantastiskt", "Idag v√§ljer jag att vara sn√§ll mot mig sj√§lv","Varje dag √§r ett nytt b√∂rjande.","Du √§r starkare √§n du tror.","Ta ett andetag ‚Äì du g√∂r ditt b√§sta.","Jag g√∂r s√• gott jag kan ‚Äì och det r√§cker f√∂r idag.","Jag √§r v√§rd respekt fr√•n andra och fr√•n mig sj√§lv.","Jag till√•ter mig sj√§lv att vila, √§ven om jag inte 'f√∂rtj√§nat' det.","Jag l√§r mig och utvecklas varje dag.","Varje dag tar jag steg mot mitt b√§sta jag.","Jag √§r kapabel att hantera utmaningar.","Jag √§r mer √§n tillr√§cklig, och jag har allt jag beh√∂ver inom mig.","Jag accepterar och √§lskar mig sj√§lv precis som jag √§r.","Mina k√§nslor √§r ok, √§ven de tr√∂tta och irriterade.","Jag ser mina styrkor och v√§xer varje dag."];
function loadL(k, fb) {
  const s = localStorage.getItem(k);
  if (s) {
    try {
      return JSON.parse(s);
    } catch (e) {
      console.warn("N√•got gick fel vid inladdning, laddar standard.", e);
    }
  }
  return [...fb];
}
function saveL(k,a){localStorage.setItem(k,JSON.stringify(a));}
let myGrat=loadL('gratList',defGrat);
let myQuotes=loadL('quoteList',defQuotes);

// ‚ïê‚ïê‚ïê THEME ‚ïê‚ïê‚ïê
let currentTheme=localStorage.getItem('theme')||'auto';
function isNight(){const h=new Date().getHours();return h>=19||h<7;}
function applyTheme(){
  const dark=currentTheme==='dark'||(currentTheme==='auto'&&isNight());
  document.body.classList.toggle('dark',dark);
}
function setTheme(t){
  currentTheme=t;localStorage.setItem('theme',t);applyTheme();
  document.querySelectorAll('.theme-opt').forEach(b=>b.classList.remove('active'));
  document.getElementById('th-'+t).classList.add('active');
  setTimeout(()=>{if(document.getElementById('tab-general').classList.contains('active'))fetchEl();},150);
}
setInterval(()=>{if(currentTheme==='auto')applyTheme();},60000);

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
(function init(){
  applyTheme();
  const t=localStorage.getItem('theme')||'auto';
  document.querySelectorAll('.theme-opt').forEach(b=>b.classList.remove('active'));
  document.getElementById('th-'+t).classList.add('active');
  const bioOn=localStorage.getItem('bioOn')==='1';
  document.getElementById('bioToggle').checked=bioOn;
  loadStats();
  updateScreenInfo();
  initLock();
})();

// ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê
function showTab(name, btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  // sidebar
  document.querySelectorAll('.side-btn').forEach(b=>b.classList.remove('active'));
  const sb=document.getElementById('sb-'+name);
  if(sb)sb.classList.add('active');
  // bottomnav
  document.querySelectorAll('.bnav-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  if(name!=='calm')stopBreath();
  if(name==='settings'){renderLists();updateScreenInfo();}
  if(name==='general'){fetchEl();}
  if(name==='stats'){loadStats();loadFocus();}
  if(name==='help'){renderHelp();}
}

function updateScreenInfo(){
  const w=window.innerWidth,h=window.innerHeight;
  const d=w>=1024?'üñ•Ô∏è Dator':w>=768?'üì± iPad':'üì± Mobil';
  const el=document.getElementById('screen-info');
  if(el)el.innerText=d+' ¬∑ '+w+'√ó'+h+'px';
}
window.addEventListener('resize',updateScreenInfo);

// ‚ïê‚ïê‚ïê FLIK 1: TACKSAMHET ‚ïê‚ïê‚ïê
const natIDs=[10,11,12,13,14,16,17,18,19,20,21,22,23,24,25,26,27,29,30,31];
function renderGratitude(){
  const c=document.getElementById('grat-cont');c.innerHTML='';
  const ids=[...natIDs].sort(()=>0.5-Math.random());
  const txts=[...myGrat].sort(()=>0.5-Math.random()).slice(0,3);
  const colors=['#111111','#1a3a6b','#1a5c2a'];
  const emojis=['üåø','üíô','üå±'];
  // Image
  const iw=document.createElement('div');iw.style.cssText='margin-bottom:12px;border-radius:16px;overflow:hidden;';
  const img=document.createElement('img');img.src='https://picsum.photos/id/'+ids[0]+'/900/400';
  img.className='grat-img';img.onerror=function(){this.style.display='none';};
  iw.appendChild(img);c.appendChild(iw);
  // Sentences
  const tc=document.createElement('div');tc.className='card';tc.style.textAlign='left';
  txts.forEach((t, i) => {
    const p = document.createElement('p');
    p.className = 'grat-line';
    p.style.color = colors[i];
    const span = document.createElement('span');
    span.innerText = emojis[i] + ' ';
    p.appendChild(span);
    p.appendChild(document.createTextNode(t));
    tc.appendChild(p);
  });
  c.appendChild(tc);
  incStat('grat');
}

// ‚ïê‚ïê‚ïê FLIK 2: LUGN ‚ïê‚ïê‚ïê
let timerInt,breathInt;

function startCustom(){
  const mins=parseInt(document.getElementById('custom-min').value)||5;
  startBreath(mins*60);
}

function startBreath(secs){
  stopBreath();
  document.getElementById('bwrap').classList.add('show');
  let left=secs;updateTimerDisp(left);
  runCycle();breathInt=setInterval(runCycle,12000);
  timerInt=setInterval(()=>{
    left--;updateTimerDisp(left);
    incStat('breath_sec');
    if(left<=0){stopBreath();alert('Bra jobbat! üåø');}
  },1000);
}

function runCycle(){
  animB('in');
  setTimeout(()=>animB('hold'),4000);
  setTimeout(()=>animB('out'),8000);
}
function animB(phase){
  const ring=document.getElementById('bring');
  const lbl=document.getElementById('breath-lbl');
  const txt=document.getElementById('btxt');
  ring.style.animation='none';void ring.offsetWidth;
  if(phase==='in'){lbl.innerText='üå¨Ô∏è Andas in...';lbl.style.color='#a5f3fc';txt.innerText='In\n4s';ring.style.animation='bIn 4s ease-in-out forwards';}
  else if(phase==='hold'){lbl.innerText='‚è∏Ô∏è H√•ll andan...';lbl.style.color='#fde68a';txt.innerText='H√•ll\n4s';ring.style.animation='bHold 4s ease-in-out forwards';}
  else{lbl.innerText='üí® Andas ut...';lbl.style.color='#bbf7d0';txt.innerText='Ut\n4s';ring.style.animation='bOut 4s ease-in-out forwards';}
}
function stopBreath(){
  clearInterval(timerInt);clearInterval(breathInt);
  document.getElementById('timer-disp').innerText='00:00';
  document.getElementById('breath-lbl').innerText='V√§lj tid och starta';
  document.getElementById('btxt').innerText='';
  document.getElementById('bwrap').classList.remove('show');
  document.getElementById('bring').style.animation='none';
  stopAllSounds();
}
function updateTimerDisp(s){const m=Math.floor(s/60),sec=s%60;document.getElementById('timer-disp').innerText=String(m).padStart(2,'0')+':'+String(sec).padStart(2,'0');}

// ‚ïê‚ïê‚ïê LJUD ‚ïê‚ïê‚ïê
let AC=null,sounds={};
function getAC(){
  if(!AC){const A=window.AudioContext||window.webkitAudioContext;if(A)AC=new A();}
  if(AC&&AC.state==='suspended')AC.resume();
  return AC;
}

function makeRain(){
  const ac=getAC();if(!ac)return null;
  const gain=ac.createGain();gain.gain.value=0;gain.connect(ac.destination);
  function addLayer(freq,q,vol){
    const buf=ac.createBuffer(1,ac.sampleRate*3,ac.sampleRate);
    const d=buf.getChannelData(0);for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
    const src=ac.createBufferSource();src.buffer=buf;src.loop=true;
    const f=ac.createBiquadFilter();f.type='bandpass';f.frequency.value=freq;f.Q.value=q;
    const g=ac.createGain();g.gain.value=vol;
    src.connect(f);f.connect(g);g.connect(gain);src.start();return src;
  }
  addLayer(600,0.8,0.6);addLayer(1200,1.2,0.4);addLayer(3000,2,0.2);
  return {gain,type:'rain'};
}

function makeOcean(){
  const ac=getAC();if(!ac)return null;
  const gain=ac.createGain();gain.gain.value=0;gain.connect(ac.destination);
  const buf=ac.createBuffer(1,ac.sampleRate*4,ac.sampleRate);
  const d=buf.getChannelData(0);for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
  const src=ac.createBufferSource();src.buffer=buf;src.loop=true;
  const f=ac.createBiquadFilter();f.type='lowpass';f.frequency.value=400;
  const lfo=ac.createOscillator();lfo.frequency.value=0.1;
  const lfoG=ac.createGain();lfoG.gain.value=200;
  lfo.connect(lfoG);lfoG.connect(f.frequency);lfo.start();
  src.connect(f);f.connect(gain);src.start();
  return {gain,type:'ocean'};
}

function makeForest(){
  const ac=getAC();if(!ac)return null;
  const gain=ac.createGain();gain.gain.value=0;gain.connect(ac.destination);
  // Soft wind base
  const buf=ac.createBuffer(1,ac.sampleRate*4,ac.sampleRate);
  const d=buf.getChannelData(0);for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
  const src=ac.createBufferSource();src.buffer=buf;src.loop=true;
  const wind=ac.createBiquadFilter();wind.type='bandpass';wind.frequency.value=300;wind.Q.value=0.5;
  const windG=ac.createGain();windG.gain.value=0.4;
  // Rustling leaves (higher freq layer)
  const buf2=ac.createBuffer(1,ac.sampleRate*2,ac.sampleRate);
  const d2=buf2.getChannelData(0);for(let i=0;i<d2.length;i++)d2[i]=Math.random()*2-1;
  const src2=ac.createBufferSource();src2.buffer=buf2;src2.loop=true;
  const leaves=ac.createBiquadFilter();leaves.type='highpass';leaves.frequency.value=2000;
  const leavesG=ac.createGain();leavesG.gain.value=0.15;
  // Slow LFO for wind gusts
  const lfo=ac.createOscillator();lfo.frequency.value=0.05;
  const lfoG=ac.createGain();lfoG.gain.value=0.2;
  lfo.connect(lfoG);lfoG.connect(windG.gain);lfo.start();
  src.connect(wind);wind.connect(windG);windG.connect(gain);
  src2.connect(leaves);leaves.connect(leavesG);leavesG.connect(gain);
  src.start();src2.start();
  return {gain,type:'forest'};
}

function makeBrown(){
  const ac=getAC();if(!ac)return null;
  const gain=ac.createGain();gain.gain.value=0;gain.connect(ac.destination);
  // Brown noise = integrated white noise (1/f¬≤)
  const buf=ac.createBuffer(1,ac.sampleRate*4,ac.sampleRate);
  const d=buf.getChannelData(0);
  let last=0;
  for(let i=0;i<d.length;i++){
    const white=Math.random()*2-1;
    last=(last+0.02*white)/1.02;
    d[i]=last*3.5;
  }
  const src=ac.createBufferSource();src.buffer=buf;src.loop=true;
  const f=ac.createBiquadFilter();f.type='lowpass';f.frequency.value=200;
  // Internal boost so slider 0.35 = same perceived loudness as others at 0.35
  const boost=ac.createGain();boost.gain.value=6;
  src.connect(f);f.connect(boost);boost.connect(gain);src.start();
  return {gain,type:'brown'};
}

function toggleSound(type){
  const btn=document.getElementById(type+'-btn');
  if(!sounds[type]){
    if(type==='rain')sounds[type]=makeRain();
    else if(type==='ocean')sounds[type]=makeOcean();
    else if(type==='forest')sounds[type]=makeForest();
    else if(type==='brown')sounds[type]=makeBrown();
  }
  if(!sounds[type])return;
  const g=sounds[type].gain;
  const labels={'rain':'P√Ö üåßÔ∏è','ocean':'P√Ö üåä','forest':'P√Ö üå≤','brown':'P√Ö üü§'};
  if(g.gain.value===0){
    const vol=parseFloat(document.getElementById(type+'-vol').value);
    g.gain.setTargetAtTime(vol,getAC().currentTime,0.3);
    btn.innerText=labels[type];btn.classList.add('on');
  }else{
    g.gain.setTargetAtTime(0,getAC().currentTime,0.3);
    btn.innerText='AV';btn.classList.remove('on');
  }
}
function setVol(type,v){
  if(sounds[type]&&sounds[type].gain.gain.value>0){
    sounds[type].gain.gain.setTargetAtTime(parseFloat(v),getAC().currentTime,0.1);
  }
}
function stopAllSounds(){
  ['rain','ocean','forest','brown'].forEach(t=>{
    if(sounds[t]){sounds[t].gain.gain.setTargetAtTime(0,getAC()?.currentTime||0,0.3);}
    const btn=document.getElementById(t+'-btn');
    if(btn){btn.innerText='AV';btn.classList.remove('on');}
  });
}

// ‚ïê‚ïê‚ïê FLIK 3: PEPP ‚ïê‚ïê‚ïê
const pEmojis=['üíö','‚≠ê','üå±','‚ú®','üí™','üåü','üî•','üåà','üíé','ü¶ã','üå∫','‚òÄÔ∏è'];
function newQuote(){
  document.getElementById('quote-txt').innerText=myQuotes[Math.floor(Math.random()*myQuotes.length)];
  document.getElementById('pepp-emoji').innerText=pEmojis[Math.floor(Math.random()*pEmojis.length)];
  incStat('pepp');
}

// ‚ïê‚ïê‚ïê FLIK 4: ALLM√ÑNT - ELPRIS ‚ïê‚ïê‚ïê
let elZone='SE3';
let elPrices=[];
let elHours=[];      // Swedish hours from time_start e.g. [0,1,2,...,23]
let elCurrentIdx=0;
let elSelectedIdx=0;

function setZone(z,btn){
  elZone=z;
  document.querySelectorAll('.zone-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  fetchEl();
}
async function fetchEl(){
  try{
    const now=new Date();
    const y=now.getFullYear();
    const m=String(now.getMonth()+1).padStart(2,'0');
    const d=String(now.getDate()).padStart(2,'0');
    const url=`https://www.elprisetjustnu.se/api/v1/prices/${y}/${m}-${d}_${elZone}.json`;
    const r=await fetch(url);
    if(!r.ok)throw new Error('API fel');
    const data=await r.json();

    // Extract correct Swedish hour from time_start: "2026-02-28T14:00:00+01:00" ‚Üí 14
    elHours=data.map(x=>parseInt(x.time_start.slice(11,13)));
    elPrices=data.map(x=>Math.round(x.SEK_per_kWh*100));

    // Match current device hour to the correct index
    const nowH=now.getHours();
    let hIdx=elHours.indexOf(nowH);
    if(hIdx===-1)hIdx=Math.max(0,Math.min(elPrices.length-1,nowH));
    elCurrentIdx=hIdx;
    elSelectedIdx=hIdx;

    const curOre=elPrices[hIdx];
    const low=Math.min(...elPrices);
    const high=Math.max(...elPrices);
    const lowIdx=elPrices.indexOf(low);
    const highIdx=elPrices.indexOf(high);
    const withVatAndTibber=Math.round(curOre*1.25+7.5);

    document.getElementById('el-now').innerText=curOre;
    document.getElementById('el-total').innerText=withVatAndTibber;
    document.getElementById('el-low').innerText=low;
    document.getElementById('el-high').innerText=high;
    // Show correct Swedish times from time_start
    document.getElementById('el-low-time').innerText=String(elHours[lowIdx]).padStart(2,'0')+':00';
    document.getElementById('el-high-time').innerText=String(elHours[highIdx]).padStart(2,'0')+':00';
    document.getElementById('el-updated').innerText='Uppdaterad '+now.toLocaleTimeString('sv-SE',{hour:'2-digit',minute:'2-digit'})+' ¬∑ Zon '+elZone;

    const slider=document.getElementById('chart-hour-slider');
    if(slider){slider.max=elPrices.length-1;slider.value=hIdx;}
    updateChartTooltip(hIdx);
    drawElChart(hIdx,hIdx);
    initChartInteraction();
  }catch(e){
    document.getElementById('el-now').innerText='‚Äì';
    document.getElementById('el-total').innerText='‚Äì';
    document.getElementById('el-updated').innerText='Kunde inte h√§mta elpris. Kontrollera internet.';
  }
}

function onChartSlider(v){
  elSelectedIdx=parseInt(v);
  updateChartTooltip(elSelectedIdx);
  drawElChart(elCurrentIdx,elSelectedIdx);
}

function updateChartTooltip(idx){
  const tt=document.getElementById('chart-tooltip');
  if(!tt||!elPrices.length)return;
  const price=elPrices[idx];
  const h=elHours[idx]??idx;
  tt.innerText=String(h).padStart(2,'0')+':00 ‚Üí '+price+' √∂re/kWh';
  tt.style.display='block';
}

function initChartInteraction(){
  const canvas=document.getElementById('el-chart');
  if(!canvas||canvas._hasInteraction)return;
  canvas._hasInteraction=true;
  function getIdxFromX(clientX){
    const rect=canvas.getBoundingClientRect();
    const W=rect.width;
    const pad={left:36,right:10};
    const cw=W-pad.left-pad.right;
    const x=clientX-rect.left-pad.left;
    const n=elPrices.length||24;
    const frac=Math.max(0,Math.min(1,x/cw));
    return Math.round(frac*(n-1));
  }
  function handleMove(clientX){
    const idx=getIdxFromX(clientX);
    elSelectedIdx=idx;
    const slider=document.getElementById('chart-hour-slider');
    if(slider)slider.value=idx;
    updateChartTooltip(idx);
    drawElChart(elCurrentIdx,idx);
  }
  canvas.addEventListener('mousedown',(e)=>{handleMove(e.clientX);});
  canvas.addEventListener('mousemove',(e)=>{if(e.buttons===1)handleMove(e.clientX);});
  canvas.addEventListener('touchstart',(e)=>{e.preventDefault();handleMove(e.touches[0].clientX);},{passive:false});
  canvas.addEventListener('touchmove',(e)=>{e.preventDefault();handleMove(e.touches[0].clientX);},{passive:false});
}

function drawElChart(currentIdx, selectedIdx){
  const prices=elPrices;
  if(!prices||!prices.length)return;
  const canvas=document.getElementById('el-chart');
  if(!canvas)return;
  const isDark=document.body.classList.contains('dark');
  const dpr=window.devicePixelRatio||1;
  const W=canvas.offsetWidth||canvas.parentElement?.offsetWidth||320;
  const H=170;
  canvas.width=W*dpr; canvas.height=H*dpr;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);

  const pad={top:14,right:14,bottom:28,left:36};
  const cw=W-pad.left-pad.right;
  const ch=H-pad.top-pad.bottom;
  const n=prices.length;
  const minP=Math.min(...prices);
  const maxP=Math.max(...prices);
  const range=maxP-minP||1;

  // Background
  ctx.fillStyle=isDark?'#1a2230':'#f0f4f0';
  ctx.roundRect(0,0,W,H,12);ctx.fill();

  // Grid + y-axis labels
  ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=pad.top+ch*(1-i/4);
    ctx.strokeStyle=isDark?'rgba(255,255,255,0.07)':'rgba(0,0,0,0.07)';
    ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+cw,y);ctx.stroke();
    const label=Math.round(minP+range*(i/4));
    ctx.fillStyle=isDark?'rgba(200,220,200,0.6)':'rgba(60,80,60,0.6)';
    ctx.font=`${Math.round(9*dpr)/dpr}px Onest,sans-serif`;
    ctx.textAlign='right';
    ctx.fillText(label,pad.left-4,y+3);
  }

  // Filled area
  const grad=ctx.createLinearGradient(0,pad.top,0,pad.top+ch);
  grad.addColorStop(0,isDark?'rgba(140,230,80,0.3)':'rgba(45,90,39,0.2)');
  grad.addColorStop(1,'rgba(0,0,0,0)');
  ctx.beginPath();
  prices.forEach((p,i)=>{
    const x=pad.left+(i/(n-1))*cw;
    const y=pad.top+ch*(1-(p-minP)/range);
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.lineTo(pad.left+cw,pad.top+ch);ctx.lineTo(pad.left,pad.top+ch);
  ctx.closePath();ctx.fillStyle=grad;ctx.fill();

  // Price line
  ctx.beginPath();
  ctx.strokeStyle=isDark?'#a8e87c':'#2d5a27';
  ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';
  prices.forEach((p,i)=>{
    const x=pad.left+(i/(n-1))*cw;
    const y=pad.top+ch*(1-(p-minP)/range);
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.stroke();

  // X-axis hour labels ‚Äî use actual Swedish hours from elHours
  ctx.fillStyle=isDark?'rgba(200,220,200,0.6)':'rgba(60,80,60,0.6)';
  ctx.font=`${Math.round(9*dpr)/dpr}px Onest,sans-serif`;
  ctx.textAlign='center';
  for(let i=0;i<n;i++){
    const h=elHours[i]??i;
    // Show label every 3 hours (when hour % 3 === 0)
    if(h%3===0){
      const x=pad.left+(i/(n-1))*cw;
      ctx.fillText(String(h).padStart(2,'0'),x,H-6);
    }
  }

  // ‚îÄ‚îÄ Selected hour line + bubble ‚îÄ‚îÄ
  const sel=selectedIdx;
  const selX=pad.left+(sel/(n-1))*cw;
  const selY=pad.top+ch*(1-(prices[sel]-minP)/range);
  const selH=elHours[sel]??sel;

  // Dashed vertical line
  ctx.beginPath();
  ctx.strokeStyle='rgba(239,83,80,0.75)';
  ctx.lineWidth=1.5;ctx.setLineDash([4,3]);
  ctx.moveTo(selX,pad.top);ctx.lineTo(selX,pad.top+ch);ctx.stroke();
  ctx.setLineDash([]);

  // Dot
  ctx.beginPath();ctx.arc(selX,selY,6,0,Math.PI*2);
  ctx.fillStyle='#ef5350';ctx.fill();
  ctx.strokeStyle='#fff';ctx.lineWidth=2;ctx.stroke();

  // Bubble with hour and price
  const bubbleTxt=String(selH).padStart(2,'0')+':00  '+prices[sel]+' √∂re';
  ctx.font=`bold ${Math.round(11*dpr)/dpr}px Onest,sans-serif`;
  const tw=ctx.measureText(bubbleTxt).width+16;
  const bh=20;
  let bx=selX-tw/2;
  bx=Math.max(pad.left,Math.min(W-pad.right-tw,bx));
  const by=selY-bh-10;
  const bubbleTop=by<pad.top?selY+10:by;

  ctx.fillStyle=isDark?'rgba(30,40,30,0.92)':'rgba(255,255,255,0.95)';
  ctx.shadowColor='rgba(0,0,0,0.2)';ctx.shadowBlur=6;
  ctx.beginPath();ctx.roundRect(bx,bubbleTop,tw,bh,6);ctx.fill();
  ctx.shadowBlur=0;

  ctx.fillStyle=isDark?'#a8e87c':'#1e3a1e';
  ctx.textAlign='left';
  ctx.fillText(bubbleTxt,bx+8,bubbleTop+14);

  // Current-hour dot (faded)
  if(sel!==currentIdx){
    const chX=pad.left+(currentIdx/(n-1))*cw;
    const chY=pad.top+ch*(1-(prices[currentIdx]-minP)/range);
    ctx.beginPath();ctx.arc(chX,chY,4,0,Math.PI*2);
    ctx.fillStyle='rgba(239,83,80,0.4)';ctx.fill();
  }
}


// ‚ïê‚ïê‚ïê √ÑNDRA PIN ‚ïê‚ïê‚ïê
function changePin(){
  // Reuse setup flow ‚Äî reset and show the in-lock setup view
  localStorage.removeItem('userPin');
  SAVED_PIN=null;
  setupStep=0;setupFirst='';se='';
  for(let i=0;i<6;i++){document.getElementById('s'+i).classList.remove('filled','error');}
  document.getElementById('setup-sub').innerText='V√§lj en ny PIN-kod (6 siffror).';
  document.getElementById('setup-err').innerText='';
  document.getElementById('lock-unlock').style.display='none';
  document.getElementById('lock-setup').style.display='flex';
  document.getElementById('lock').classList.remove('hidden');
}

// ‚ïê‚ïê‚ïê DAGLIGT FOKUS ‚ïê‚ïê‚ïê
function loadFocus(){
  try{
    const f=JSON.parse(localStorage.getItem('dailyFocus')||'{}');

    const today=new Date().toDateString();
    const disp=document.getElementById('focus-display');
    const inp=document.getElementById('focus-input');
    const dateEl=document.getElementById('focus-date');
    if(!disp)return;
    if(f.date===today&&f.text){
      disp.innerText='"'+f.text+'"';
      disp.style.display='block';
      if(inp)inp.value=f.text;
      if(dateEl)dateEl.innerText='Sparad idag';
    }else{
      disp.style.display='none';
      if(dateEl)dateEl.innerText='';
    }
  }catch(e){}
}
function saveFocus(){
  const inp=document.getElementById('focus-input');
  if(!inp)return;
  const v=inp.value.trim();
  if(!v)return;
  const today=new Date().toDateString();
  localStorage.setItem('dailyFocus',JSON.stringify({text:v,date:today}));
  const disp=document.getElementById('focus-display');
  if(disp){disp.innerText='"'+v+'"';disp.style.display='block';}
  const dateEl=document.getElementById('focus-date');
  if(dateEl)dateEl.innerText='Sparad idag ‚úì';
}

// ‚ïê‚ïê‚ïê STATISTIK ‚ïê‚ïê‚ïê
function loadStats(){
  const s=JSON.parse(localStorage.getItem('stats')||'{}');
  const mins=Math.floor((s.breath_sec||0)/60);
  document.getElementById('st-breath').innerText=mins+' min';
  document.getElementById('st-grat').innerText=s.grat||0;
  document.getElementById('st-pepp').innerText=s.pepp||0;
  const streak=s.streak||0;
  document.getElementById('st-streak').innerText=streak;
  document.getElementById('streak-badge').innerText='üî• '+streak+' dagars streak';
}
function incStat(key){
  const s=JSON.parse(localStorage.getItem('stats')||'{}');
  s[key]=(s[key]||0)+1;
  localStorage.setItem('stats',JSON.stringify(s));
  loadStats();
}
function resetStats(){
  if(confirm('Nollst√§lla all statistik?')){localStorage.removeItem('stats');loadStats();}
}
function updateStreak(){
  const s=JSON.parse(localStorage.getItem('stats')||'{}');
  const today=new Date().toDateString();
  if(s.lastDay===today)return;
  const yesterday=new Date(Date.now()-86400000).toDateString();
  s.streak=s.lastDay===yesterday?(s.streak||0)+1:1;
  s.lastDay=today;
  localStorage.setItem('stats',JSON.stringify(s));
  loadStats();
}

// ‚ïê‚ïê‚ïê INST√ÑLLNINGAR ‚ïê‚ïê‚ïê
function renderLists(){
  renderList('grat-list',myGrat,removeGrat);
  renderList('quote-list',myQuotes,removeQuote);
}
function renderList(id,arr,fn){
  const el=document.getElementById(id);el.innerHTML='';
  arr.forEach((t,i)=>{
    const d=document.createElement('div');d.className='list-item';
    d.innerHTML='<span>'+t+'</span><button class="del-btn" onclick="('+fn.name+')('+i+')">‚úï</button>';
    el.appendChild(d);
  });
}
function addGrat(){const i=document.getElementById('newGratIn');const v=i.value.trim();if(!v)return;myGrat.push(v);saveL('gratList',myGrat);i.value='';renderLists();}
function removeGrat(i){myGrat.splice(i,1);saveL('gratList',myGrat);renderLists();}
function addQuote(){const i=document.getElementById('newQuoteIn');const v=i.value.trim();if(!v)return;myQuotes.push(v);saveL('quoteList',myQuotes);i.value='';renderLists();}
function removeQuote(i){myQuotes.splice(i,1);saveL('quoteList',myQuotes);renderLists();}

// ‚ïê‚ïê‚ïê HJ√ÑLP DATA ‚ïê‚ïê‚ïê
const helpData = [
  // ‚îÄ‚îÄ RESONERA MED DINA TANKAR ‚îÄ‚îÄ
  { id:'h1', cat:'tankar', tags:['negativa tankar','grubbel','ifr√•gas√§tta'],
    title:'Hur t√§nker andra i samma situation?',
    preview:'S√§tt dina tankar i perspektiv genom att fundera p√• vad andra skulle t√§nka.',
    detail:`<strong>Fr√•ga dig sj√§lv:</strong><br>Hur t√§nker andra i en s√•dan h√§r situation? Vad kan man f√∂rv√§nta sig av n√•gon med dessa f√∂ruts√§ttningar? Hur resonerar mina n√§rmaste ‚Äî sl√§ktingar, v√§nner, arbetskamrater?<br><br><em>Tips: T√§nk dig en god v√§n i din sits. Vad skulle du s√§ga till hen?</em>` },

  { id:'h2', cat:'tankar', tags:['tankef√§lla','m√∂nster','sj√§lvkritik'],
    title:'√Ñr detta ett tankem√∂nster / en tankef√§lla?',
    preview:'Identifiera om du fastnat i ett negativt tankem√∂nster.',
    detail:`<strong>Fr√•ga dig:</strong><br>√Ñr detta ett tankem√∂nster? Vilken tankef√§lla √§r det i s√• fall? Varf√∂r kan man kalla det en tankef√§lla?<br><br>Se fliken <em>Tankef√§llor</em> f√∂r en komplett lista med l√∂sningar.` },

  { id:'h3', cat:'verktyg', tags:['fakta','bevis','verklighet'],
    title:'Hur pr√∂var jag riktigheten i mina f√∂rest√§llningar?',
    preview:'Skilj fakta fr√•n tankar och f√∂rest√§llningar.',
    detail:`<strong>Verktyg:</strong><br>Fr√•ga dig: √Ñr detta fakta som jag vet med s√§kerhet? Hur har jag kommit fram till denna tanke? N√§r d√∂k den upp f√∂r f√∂rsta g√•ngen?<br><br>Vilka <em>bevis</em> finns f√∂r tankens giltighet? Vilka bevis talar <em>emot</em>? Hur kan jag ta reda p√• om det jag √§r √∂vertygad om verkligen √§r sant?` },

  { id:'h4', cat:'verktyg', tags:['fakta','bevis','s√§kerhet','ursprung'],
    title:'√Ñr detta fakta jag vet med s√§kerhet?',
    preview:'Unders√∂k om dina √∂vertygelser √§r grundade i fakta.',
    detail:`<strong>Unders√∂k tanken:</strong><br>‚Ä¢ √Ñr detta fakta som jag vet med s√§kerhet?<br>‚Ä¢ Hur har jag kommit fram till denna tanke?<br>‚Ä¢ N√§r d√∂k denna tanke upp f√∂r f√∂rsta g√•ngen?<br>‚Ä¢ Vilka bevis finns f√∂r tankens giltighet?<br>‚Ä¢ Hur kan jag ta reda p√• om det jag √§r √∂vertygad om verkligen √§r sant?` },

  { id:'h5', cat:'verktyg', tags:['scenario','v√§rsta','b√§sta','realistiskt','sannolikhet'],
    title:'V√§rsta, troligaste och b√§sta scenariot',
    preview:'Skatta sannolikheten f√∂r olika utfall 0‚Äì100.',
    detail:`<strong>Tre scenarion:</strong><br><strong>A.</strong> Vad √§r det <em>v√§rsta</em> som kan h√§nda?<br><strong>B.</strong> Vad √§r det <em>troligaste</em> som kommer att h√§nda? Vad brukar h√§nda? Vad har h√§nt vid liknande tillf√§llen? Vad √§r mest realistiskt?<br><strong>C.</strong> Vad √§r det <em>b√§sta</em> som kan h√§nda?<br><br>Skatta sedan sannolikheten fr√•n 0‚Äì100 att A, B eller C intr√§ffar. De flesta g√•nger √§r B mer sannolikt √§n vi tror.` },

  { id:'h6', cat:'tankar', tags:['tv√§rtom','omv√§nd','perspektiv'],
    title:'T√§nk om! Kan det vara tv√§rtom?',
    preview:'Utmana din tanke genom att v√§nda p√• den.',
    detail:`<strong>√ñvning:</strong><br>"T√§nk om! Kan det vara tv√§rtom mot vad jag t√§nker?"<br><br>Formulera din negativa tanke. Formulera nu <em>exakt motsatsen</em>. Vilken av dem st√∂ds b√§st av bevis? Ofta √§r sanningen mitt emellan.` },

  { id:'h7', cat:'tankar', tags:['tid','f√∂r√§ndring','framtid','perspektiv'],
    title:'T√§nkte jag s√• h√§r f√∂r ett √•r sedan?',
    preview:'S√§tt tanken i ett tidsperspektiv.',
    detail:`<strong>Tidsperspektiv:</strong><br>T√§nkte jag s√• h√§r f√∂r ett √•r sedan? Hur skulle jag <em>vilja</em> t√§nka om ett √•r?<br><br>Ofta f√∂r√§ndras saker mer √§n vi tror. Denna √∂vning hj√§lper dig se att tanken kanske inte √§r permanent sann.` },

  { id:'h8', cat:'tankar', tags:['nyttig','hj√§lpsam','konstruktiv'],
    title:'√Ñr detta en nyttig och bra tanke f√∂r mig?',
    preview:'Fr√•ga om tanken tj√§nar dig eller stj√§lper dig.',
    detail:`<strong>Fr√•ga dig:</strong><br>√Ñr denna tanke nyttig och bra f√∂r mig? Hj√§lper den mig att n√• mina m√•l eller m√•r bra?<br><br>√Ñven om en tanke √§r "sann" kan den vara skadlig att b√§ra p√•. Fr√•ga dig om du vill l√§gga energi p√• den.` },

  { id:'h9', cat:'verktyg', tags:['hj√§lp','andra','fr√•ga','st√∂d'],
    title:'Vilken hj√§lp kan jag f√• av andra?',
    preview:'Utforska m√∂jligheten att fr√•ga om r√•d och st√∂d.',
    detail:`<strong>Socialt st√∂d:</strong><br>Vilken hj√§lp kan jag f√• av andra? Kan jag fr√•ga andra vad de vet, hur de brukar g√∂ra?<br><br>Vi beh√∂ver inte l√∂sa allt sj√§lva. Att be om hj√§lp √§r styrka, inte svaghet.` },

  { id:'h10', cat:'verktyg', tags:['resurser','styrkor','probleml√∂sning','kapacitet'],
    title:'Vilka egna resurser har jag?',
    preview:'Identifiera dina styrkor och hur du kan anv√§nda dem.',
    detail:`<strong>Dina resurser:</strong><br>Vilka egna resurser har du f√∂r att klara av detta problem? Hur brukar du l√∂sa problem? Vilka √§r dina <em>starka sidor</em> och hur brukar du anv√§nda dem?<br><br>Skriv ned minst tre saker du √§r bra p√• eller har klarat f√∂rut.` },

  { id:'h11', cat:'tankar', tags:['krav','realistiska','perfektionism','acceptans'],
    title:'Vad kan jag beg√§ra av mig sj√§lv?',
    preview:'S√§tt realistiska krav p√• dig sj√§lv.',
    detail:`<strong>Rimliga krav:</strong><br>Vad kan jag beg√§ra av mig sj√§lv i den h√§r situationen? Vilka krav √§r realistiska? Kan jag klara allt? <em>M√•ste</em> jag klara allt perfekt?<br><br>Ofta s√§tter vi om√∂jliga krav p√• oss sj√§lva. Sikta p√• "tillr√§ckligt bra" ‚Äî inte perfekt.` },

  { id:'h12', cat:'tankar', tags:['kontroll','acceptans','oro','os√§kerhet'],
    title:'Hur mycket kontroll beh√∂ver jag ha?',
    preview:'Utforska vad som faktiskt √§r m√∂jligt att kontrollera.',
    detail:`<strong>Kontroll och acceptans:</strong><br>Hur mycket kontroll √∂ver situationen m√•ste jag ha? Kan man ha fullst√§ndig kontroll ‚Äî och beh√∂vs det?<br><br>Dela upp i: <em>Kan jag p√•verka detta?</em> Om ja ‚Üí agera. Om nej ‚Üí √∂va acceptans och sl√§pp taget.` },

  { id:'h13', cat:'tankar', tags:['positiv','omformulera','nytt perspektiv'],
    title:'Finns det en positiv tanke ist√§llet?',
    preview:'Hitta en alternativ, mer hj√§lpsam tanke.',
    detail:`<strong>Omformulering:</strong><br>Finns det n√•gon positiv tanke jag kan t√§nka n√§r det g√§ller mitt problem?<br><br>Det handlar inte om att l√•tsas att allt √§r bra ‚Äî utan att hitta en <em>mer balanserad</em> och konstruktiv tanke att ers√§tta den negativa med.` },

  // ‚îÄ‚îÄ TANKEF√ÑLLOR ‚îÄ‚îÄ
  { id:'tf1', cat:'tankefallor', tags:['svart vitt','kategorisk','allt eller inget'],
    title:'Tankef√§lla 1: Svart-vitt t√§nkande',
    preview:'Du ser saker onyanserat ‚Äî antingen/eller. "Ingen tycker om mig."',
    detail:`<strong>Vad det √§r:</strong><br>Du ser saker onyanserat, antingen‚Äìeller, allt eller inget. <em>"Ingen tycker om mig."</em><br><br><strong>Hur du bryter den:</strong><br>F√∂rs√∂k se gr√•skala. Var mindre kategorisk. Anv√§nd hela spektrat 0‚Äì100 ist√§llet f√∂r svart/vitt. Fr√•ga: "√Ñr det verkligen 0 % eller 100 %?"` },

  { id:'tf2', cat:'tankefallor', tags:['√∂vergeneralisering','misslyckande','alltid','aldrig'],
    title:'Tankef√§lla 2: √ñvergeneralisering',
    preview:'Du ser en negativ h√§ndelse som ett tecken p√• att allt √§r fel.',
    detail:`<strong>Vad det √§r:</strong><br>Du ser <em>en</em> negativ h√§ndelse som ett tecken p√• att allt √§r fel. T.ex. du misslyckas p√• en tenta och t√§nker <em>"Jag kan ingenting"</em>.<br><br><strong>Hur du bryter den:</strong><br>Unders√∂k konkreta bel√§gg. Hur ofta har detta h√§nt? Vad var det faktiska utfallet de andra g√•ngerna?` },

  { id:'tf3', cat:'tankefallor', tags:['etikettering','bluff','negativ sj√§lvbild'],
    title:'Tankef√§lla 3: Etikettering',
    preview:'Du ger dig sj√§lv och andra negativa generella etiketter.',
    detail:`<strong>Vad det √§r:</strong><br>Du tillskriver dig sj√§lv eller andra allm√§nna, negativa egenskaper. <em>"Jag √§r en bluff"</em>, <em>"Hon √§r en skvallerbytta"</em>.<br><br><strong>Hur du bryter den:</strong><br>Unders√∂k faktabevis. Nyansera. Beteenden √§r inte identiteter ‚Äî du <em>gjorde</em> ett misstag, du <em>√§r</em> inte ett misstag.` },

  { id:'tf4', cat:'tankefallor', tags:['m√•sten','borden','perfektionism','krav'],
    title:'Tankef√§lla 4: Borden / M√•sten',
    preview:'Du s√§tter orealistiska krav p√• dig sj√§lv med "m√•ste" och "borde".',
    detail:`<strong>Vad det √§r:</strong><br>Du s√§ger till dig sj√§lv att saker och ting b√∂r eller m√•ste vara p√• ett visst s√§tt. Du s√§tter orealistiska krav p√• dig sj√§lv.<br><br><strong>Hur du bryter den:</strong><br>S√§tt saker i perspektiv. Hur viktigt √§r det om 10 √•r? Ers√§tt "m√•ste/borde" med <em>"jag skulle vilja / det vore bra / jag skulle f√∂redra"</em>. S√§nk kraven till 70 %. Fokusera p√• nuet.` },

  { id:'tf5', cat:'tankefallor', tags:['tankel√§sning','andras tankar','bel√§gg','antaganden'],
    title:'Tankef√§lla 5: Tankel√§sning',
    preview:'Du tror att du vet vad andra t√§nker utan bel√§gg.',
    detail:`<strong>Vad det √§r:</strong><br>Du tror att du vet vad andra t√§nker utan att ha bel√§gg f√∂r det. <em>"Hon tycker inte om mig."</em><br><br><strong>Hur du bryter den:</strong><br>Unders√∂k faktabevis. S√∂k alternativa f√∂rklaringar till varf√∂r andra beter sig som de g√∂r. Anv√§nd andra som referenspunkt, t.ex. genom rollspel (omv√§nda roller). Fr√•ga andra direkt.` },

  { id:'tf6', cat:'tankefallor', tags:['k√§nslot√§nkande','k√§nsla','fakta','v√§rdel√∂s'],
    title:'Tankef√§lla 6: K√§nslot√§nkande',
    preview:'Du l√•ter dina k√§nslor styra verklighetsuppfattningen.',
    detail:`<strong>Vad det √§r:</strong><br>Du l√•ter dina k√§nslor styra din uppfattning om verkligheten. <em>"Jag k√§nner mig v√§rdel√∂s, ingen vill vara med mig."</em><br><br><strong>Hur du bryter den:</strong><br>Skilj k√§nsla fr√•n fakta. K√§nslor duger inte som bevis i en domstol. G√∂r ett rollspel mellan det rationella och det emotionella.` },

  { id:'tf7', cat:'tankefallor', tags:['katastrofiering','oro','√•ngest','v√§rsta','konkurs'],
    title:'Tankef√§lla 7: Katastrofiering',
    preview:'Du tror att allt kommer g√• √•t skogen och att du inte kan fixa det.',
    detail:`<strong>Vad det √§r:</strong><br>Du tror att allt kommer g√• √•t skogen och du kommer inte att fixa det. <em>"Det blir hemskt om jag misslyckas"</em>, <em>"T√§nk om jag g√•r i konkurs"</em>.<br><br><strong>Hur du bryter den:</strong><br>Unders√∂k faktabevis. Testa hypoteser. Vad √§r det v√§rsta som <em>faktiskt</em> kan h√§nda? Vad √§r det b√§sta? Det mest sannolika? Bli statistiker. Skilj p√• m√∂jligt och troligt.` },

  { id:'tf8', cat:'tankefallor', tags:['personifiering','sj√§lvanklagelse','ansvar','skuld'],
    title:'Tankef√§lla 8: Personifiering och sj√§lvanklagelse',
    preview:'Du t√§nker att allt handlar om dig eller √§r ditt fel.',
    detail:`<strong>Vad det √§r:</strong><br>Du t√§nker att allt handlar om dig eller att allt √§r ditt ansvar och ditt fel.<br><br><strong>Hur du bryter den:</strong><br>Lyft blicken ‚Äî anv√§nd andra som referenspunkt. Sluta anklaga dig sj√§lv. Hur mycket ansvar har just du? Vad i situationen har kunnat bidra till att det blivit som det blivit?` },

  { id:'tf9', cat:'tankefallor', tags:['selektiv perception','negativ','j√§mf√∂ra','positiv'],
    title:'Tankef√§lla 9: Selektiv perception',
    preview:'Du ser bara de negativa delarna och ignorerar det positiva.',
    detail:`<strong>Vad det √§r:</strong><br>Du ser bara vissa delar av helheten ‚Äî de negativa ‚Äî och ignorerar det positiva. Du j√§mf√∂r dig med de som √§r mer framg√•ngsrika, inte med de som har det s√§mre.<br><br><strong>Hur du bryter den:</strong><br>Uppm√§rksamma fler aspekter av situationen. G√∂r en lista p√• det som √§r positivt. J√§mf√∂r dig med de mindre lyckligt lottade. Schemal√§gg positiva aktiviteter.` },

  { id:'tf10', cat:'tankefallor', tags:['f√∂rstoring','f√∂rminskning','misslyckande','framg√•ng'],
    title:'Tankef√§lla 10: F√∂rstoring / F√∂rminskning',
    preview:'Du f√∂rstoras dina misslyckanden och f√∂rminskar dina framg√•ngar.',
    detail:`<strong>Vad det √§r:</strong><br>Du h√∂jer en fj√§der n√§r du misslyckas och f√∂rringar dina framg√•ngar. Du har sv√•rt att ge ber√∂m till dig eller andra.<br><br><strong>Hur du bryter den:</strong><br>Unders√∂k faktabevis. Se saker i r√§tt perspektiv. Ge dig erk√§nnande f√∂r framg√•ngar och se motg√•ngarna i ett st√∂rre perspektiv.` },
];

let helpCat = 'all';
let helpQuery = '';

function renderHelp(){
  const cont = document.getElementById('help-results');
  if(!cont) return;
  const q = helpQuery.toLowerCase();
  const items = helpData.filter(item => {
    const matchCat = helpCat==='all' || item.cat===helpCat;
    const matchQ = !q || item.title.toLowerCase().includes(q) ||
      item.preview.toLowerCase().includes(q) ||
      item.detail.toLowerCase().includes(q) ||
      item.tags.some(t=>t.includes(q));
    return matchCat && matchQ;
  });
  if(items.length===0){
    cont.innerHTML='<div class="no-results">üòî Inget hittades f√∂r "'+helpQuery+'"<br><small>Prova ett annat s√∂kord</small></div>';
    return;
  }
  // Group by category
  const groups = {};
  items.forEach(item=>{
    const gName = item.cat==='tankar'?'üí≠ Resonera med dina tankar':
                  item.cat==='tankefallor'?'ü™§ Tankef√§llor och hur man bryter dem':
                  'üõ†Ô∏è Verktyg & √ñvningar';
    if(!groups[gName])groups[gName]=[];
    groups[gName].push(item);
  });
  let html='';
  for(const [gTitle, gitems] of Object.entries(groups)){
    html+='<div class="card help-section">';
    html+='<div class="help-section-title">'+gTitle+'</div>';
    gitems.forEach(item=>{
      html+=`<div class="help-item" onclick="toggleHelpDetail('${item.id}')">
        <div class="help-item-title">${item.title}</div>
        <div class="help-item-preview">${item.preview}</div>
        <div style="margin-top:6px;">${item.tags.map(t=>'<span class="help-tag">'+t+'</span>').join('')}</div>
      </div>
      <div class="help-detail" id="hd-${item.id}">
        <div class="help-detail-text">${item.detail}</div>
      </div>`;
    });
    html+='</div>';
  }
  cont.innerHTML=html;
}

function toggleHelpDetail(id){
  const el=document.getElementById('hd-'+id);
  if(!el)return;
  el.classList.toggle('open');
}
function filterHelp(q){helpQuery=q;renderHelp();}
function filterCat(cat,btn){
  helpCat=cat;
  document.querySelectorAll('.help-cat').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  renderHelp();
}

// ‚ïê‚ïê‚ïê START ‚ïê‚ïê‚ïê
renderGratitude();
newQuote();
renderHelp();
</script>
</body>
</html>
